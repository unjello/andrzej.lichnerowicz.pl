<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="og:title" content="December Adventure 2024 | @unjello" />
    <meta property="twitter:title" content="December Adventure 2024 | @unjello" />
    <meta property="og:url" content="http://andrzej.lichnerowicz.pl/en/blog/december-adventure-2024/" />
    <meta property="og:type" content="blog" />
     
    <meta property="og:image" content="http://andrzej.lichnerowicz.pl/en/blog/december-adventure-2024/images/IMG_3064.jpg" />
    <meta property="twitter:image" content="http://andrzej.lichnerowicz.pl/en/blog/december-adventure-2024/images/IMG_3064.jpg" />
     
    <meta property="og:description" content="The December Adventure is low key. The goal is to write a little bit of code every day in December." />
    <meta property="twitter:description" content="The December Adventure is low key. The goal is to write a little bit of code every day in December." />
    
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" href="/favicon.ico" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.1.7/purify.min.js"
      integrity="sha512-BdRNuI8/lsyxkKQVxK1lVtfZshggfXPAwEP+JAOJEKx6Y8SLfcBSRdaWyXQmMxo+wG180uFqXYGjGRL0mh4/Jw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

     
    <link
      rel="stylesheet"
      href="/css/style.min.3a7155bb510c74d3ad0ee88347caccee2f18b7d2005edd786edc9f75caca9f7b.css"
      integrity="sha256-OnFVu1EMdNOtDuiDR8rM7i8Yt9IAXt14btyfdcrKn3s="
      crossorigin="anonymous"
    />
     
    <title>December Adventure 2024 | Blog @unjello</title>
  </head>
  <body>
    <canvas
      id="decay-canvas"
      width="3172"
      height="440"
      style="height: 220px; width: 1586px"
    ></canvas>
    <div class="layout container-fluid">
      <header>
        <h1>
          <a href="/">Andrzej unjello Lichnerowicz</a>
        </h1>
        <ul class="list-inline tagline">
          
          <li class="list-inline-item">he</li>
          
          <li class="list-inline-item">him</li>
          
          <li class="list-inline-item">activist</li>
          
          <li class="list-inline-item">trees and greenery lover</li>
          
        </ul>
        <ul class="list-inline socialmedia">
          
          <li class="list-inline-item">
            <a href="https://mastodon.gamedev.place/@unjello">mastodon</a>
          </li>
          
          <li class="list-inline-item">
            <a href="https://codeberg.org/unjello">codeberg</a>
          </li>
          
          <li class="list-inline-item">
            <a href="mailto:andrzej@lichnerowicz.pl">email</a>
          </li>
          
          <li class="list-inline-item">
            <a href="https://andrzej.lichnerowicz.pl/public.pgp">pgp</a>
          </li>
          
        </ul>
      </header>

      <section class="blog_single">
        <h1>December Adventure 2024</h1>
        <div class="date">2024-12-12T21:10:15&#43;02:00</div>
        <div class="content">
          <p>I have stumbled across a <a href="https://mastodon.gamedev.place/@crc@bsd.cafe/113555993612328150">post</a> on mastodon. I never really took part in no trends, but this somehow had the right vibes, or maybe I changed? Dunno. The point is, I feel like I want to do it :)</p>
<p>So inspired by <a href="https://mastodon.gamedev.place/@eli_oat@tenforward.social">@eli_oat</a>, with a whole <a href="https://eli.li/december-adventure">webring</a> going on, without further ado:</p>
<h1 id="day-20">Day 20</h1>
<p>Not much today. Spent most of my time re-doing my office. New floors, new furniture. IKEA nesting instict, but I must say the desk hack to use kitchen table as desk top rocks. Looks very nice, is solid, and cost like 25% of hardwood desk top. Finally starts to feel like something I out of a fancy youtuber&rsquo;s background ;&gt;</p>
<h1 id="day-19">Day 19</h1>
<p>Inspired by <a href="https://mastodon.social/@mcc/113676267668601431">@mcc@mastodon.social</a>, I&rsquo;ve decided to start a list of languages I am planning on exploring/refreshing next year, while catching up on Advent of Code that I sort of abandoned around day 06. And because everything needs to have a label or a hashtag these days, imma name it <code>#BabelOfCode</code> &ndash; I am not going to rush like in Advent of Code, especially it&rsquo;s not a competitive coding scenario. Every week I am going to take a puzzle from 2024 AoC pool, starting from Day 01, and every puzzle I am going to implement in a different langauge, or a flavor of a language, to explore the toolchain, its standard library and its idioms (i.e Pure Scheme vs Racket vs Common Lisp) or a platform (e.g. Intel vs ARM CPU or Linux vs Windows). After a bit of struggling over the past year, I think I have finally settled with Rust as my language of choice. It seems as a sane tradeoff between reason and passion. I always believed tho that one benefits greatly from learning different perspectives, so to broaden mine, I&rsquo;ll do a bit of language tourism :)</p>
<p>Here&rsquo;s the list of languages I am planning on covering. 25 days, 25 languages:</p>
<ol>
<li>Assembly (MASM, DOS)</li>
<li>C (WATCOM, DOS)</li>
<li>Uxntal</li>
<li>Prolog</li>
<li>AWK</li>
<li>Fish</li>
<li>Lua</li>
<li><a href="https://sr.ht/~icefox/garnet/">Garnet</a></li>
<li><a href="https://scopes.readthedocs.io/en/latest/">Scopes</a></li>
<li>OCaml</li>
<li>Haskell</li>
<li><a href="https://iolanguage.org">IO</a></li>
<li>Common Lisp</li>
<li>PureScript</li>
<li>Fortran</li>
<li>Forth</li>
<li>COBOL</li>
<li>Scala</li>
<li>Oberon</li>
<li>Modula-2</li>
<li>ADA</li>
<li>Raku</li>
<li>Gleam</li>
<li>Pharo</li>
<li>J</li>
</ol>
<p>I am going to refactor this to a separate post at some point when I start. Cheers. <code>#BabelOfCode</code></p>
<h1 id="day-18">Day 18</h1>
<p>So I dived deeper into the bug I found yesterday. After fixing some low hanging fruits where I missed to consume whitespaces and newlines (oh, in moments like these I wish I had a lexer first:) I found an interesting bug, or rather a feature, in my PEG parser. I have a following block:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">O</span> <span style="color:#a6e22e">RLY</span><span style="color:#960050;background-color:#1e0010">?</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">YA</span> <span style="color:#a6e22e">RLY</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#e6db74">&#34;J00 HAV A CAT&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">NO</span> <span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#e6db74">&#34;J00 SUX&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">OIC</span>
</span></span></code></pre></div><p>And the way parser goes is&hellip;tadum, tsss&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">block_statement_separator</span>               <span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;\nNO WAI, VISIBLE \&#34;J00
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &gt; alt                                    | &#34;</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">nNO</span> <span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &gt; &#34;</span>,<span style="color:#e6db74">&#34;                                   | &#34;</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">nNO</span> <span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt; &#34;</span>,<span style="color:#e6db74">&#34;                                   | backtrack
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &gt; line_ending                           | &#34;</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">nNO</span> <span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         &gt; alt                                  | &#34;</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">nNO</span> <span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &gt; &#34;</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">n</span><span style="color:#e6db74">&#34;                                | &#34;</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">nNO</span> <span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt; &#34;</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">n</span><span style="color:#e6db74">&#34;                                | +1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         &lt; alt                                  | +1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt; line_ending                           | +1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &lt; alt                                    | +1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &lt; block_statement_separator               | +1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     &lt; terminated                               | +24
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &lt; block_statement                           | +24
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &gt; program_end                               | &#34;</span><span style="color:#a6e22e">NO</span> <span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00 SU
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     &gt; &#34;</span><span style="color:#a6e22e">KTHXBYE</span><span style="color:#e6db74">&#34;                                | &#34;</span><span style="color:#a6e22e">NO</span> <span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00 SU
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">     &lt; &#34;</span><span style="color:#a6e22e">KTHXBYE</span><span style="color:#e6db74">&#34;                                | backtrack
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">   &lt; pr ogram_end                               | backtrack
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &gt; block_statement:1                         | &#34;</span><span style="color:#a6e22e">NO</span> <span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00 SU
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">...
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#e6db74">            &gt; variable_reference                | &#34;</span><span style="color:#a6e22e">NO</span> <span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00 SU
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#e6db74">             &gt; variable_name                    | &#34;</span><span style="color:#a6e22e">NO</span> <span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00 SU
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#e6db74">              &gt;                                 | &#34;</span><span style="color:#a6e22e">NO</span> <span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00 SU
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#e6db74">               &gt; take_while                     | &#34;</span><span style="color:#a6e22e">NO</span> <span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00 SU
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#e6db74">               &lt; take_while                     | +1
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#e6db74">               &gt; take_while                     | &#34;</span><span style="color:#a6e22e">O</span> <span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00 SUX
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#e6db74">               &lt; take_while                     | +1
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#e6db74">              &lt;                                 | +2
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#e6db74">             &lt; variable_name                    | +2
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#e6db74">            &lt; variable_reference                | +2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">           &lt; alt                                | +2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt; expression                          | +2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         &lt; alt                                  | +2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt; statement                             | +2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &lt; preceded:1                             | +2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &gt; space0                                 | &#34;</span> <span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00 SUX\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &gt; take_while                            | &#34;</span> <span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00 SUX\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt; take_while                            | +1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &lt; space0                                 | +1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &lt; terminated:1                            | +3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      &gt; block_statement_separator:1             | &#34;</span><span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00 SUX\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">       &gt; alt:1                                  | &#34;</span><span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00 SUX\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &gt; &#34;</span>,<span style="color:#e6db74">&#34;                                   | &#34;</span><span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00 SUX\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &lt; &#34;</span>,<span style="color:#e6db74">&#34;                                   | backtrack
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &gt; line_ending                           | &#34;</span><span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00 SUX\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         &gt; alt                                  | &#34;</span><span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00 SUX\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &gt; &#34;</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">n</span><span style="color:#e6db74">&#34;                                | &#34;</span><span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00 SUX\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt; &#34;</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">n</span><span style="color:#e6db74">&#34;                                | backtrack
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &gt; &#34;</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">r</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">n</span><span style="color:#e6db74">&#34;                              | &#34;</span><span style="color:#a6e22e">WAI</span>, <span style="color:#a6e22e">VISIBLE</span> <span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;J00 SUX\&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &lt; &#34;</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">r</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#a6e22e">n</span><span style="color:#960050;background-color:#1e0010">&#34;</span>                              <span style="color:#f92672">|</span> <span style="color:#a6e22e">backtrack</span>
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">alt</span>                                  <span style="color:#f92672">|</span> <span style="color:#a6e22e">backtrack</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">line_ending</span>                           <span style="color:#f92672">|</span> <span style="color:#a6e22e">backtrack</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">alt</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">1</span>                                  <span style="color:#f92672">|</span> <span style="color:#a6e22e">backtrack</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">block_statement_separator</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">1</span>             <span style="color:#f92672">|</span> <span style="color:#a6e22e">backtrack</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">terminated</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">1</span>                             <span style="color:#f92672">|</span> <span style="color:#a6e22e">backtrack</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">block_statement</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">1</span>                         <span style="color:#f92672">|</span> <span style="color:#a6e22e">backtrack</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">repeat_till</span>                                <span style="color:#f92672">|</span> <span style="color:#a6e22e">backtrack</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">block</span>                                       <span style="color:#f92672">|</span> <span style="color:#a6e22e">backtrack</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">&lt;</span>                                              <span style="color:#f92672">|</span> <span style="color:#a6e22e">backtrack</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">ya_rly</span>                                        <span style="color:#f92672">|</span> <span style="color:#a6e22e">backtrack</span></span></span></code></pre></div>
<p>And here I am, making the very mistake I told during the talk to avoid. Currently my grammar looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> Scanner <span style="color:#66d9ef">for</span> Statement {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">parse</span>(input: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">mut</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; <span style="color:#a6e22e">PResult</span><span style="color:#f92672">&lt;</span>Statement<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>        alt((
</span></span><span style="display:flex;"><span>            Statement::parse_if,
</span></span><span style="display:flex;"><span>            Statement::parse_comment,
</span></span><span style="display:flex;"><span>            Statement::parse_visible,
</span></span><span style="display:flex;"><span>            Statement::parse_variable_definition,
</span></span><span style="display:flex;"><span>            Statement::parse_variable_assignment,
</span></span><span style="display:flex;"><span>            Expression::parse.map(<span style="color:#f92672">|</span>v<span style="color:#f92672">|</span> Statement::ExpressionStatement(v)),
</span></span><span style="display:flex;"><span>        )).parse_next(input)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">parse_if</span>(input: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">mut</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; <span style="color:#a6e22e">PResult</span><span style="color:#f92672">&lt;</span>Statement<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;if&#34;</span>,
</span></span><span style="display:flex;"><span>        seq!((
</span></span><span style="display:flex;"><span>            _: <span style="color:#a6e22e">Caseless</span>(<span style="color:#e6db74">&#34;O RLY?&#34;</span>), _: (till_line_ending, line_ending),
</span></span><span style="display:flex;"><span>            trace(<span style="color:#e6db74">&#34;ya_rly&#34;</span>, seq!(_: <span style="color:#a6e22e">Caseless</span>(<span style="color:#e6db74">&#34;YA RLY,&#34;</span>),
</span></span><span style="display:flex;"><span>            _: <span style="color:#a6e22e">space1</span>,
</span></span><span style="display:flex; background-color:#3c3d38"><span>            Block::parse)),
</span></span><span style="display:flex;"><span>            opt(seq!(_: <span style="color:#a6e22e">Caseless</span>(<span style="color:#e6db74">&#34;MEBBE&#34;</span>), Expression::parse, _: <span style="color:#a6e22e">delimited</span>(space1, <span style="color:#e6db74">&#34;, &#34;</span>, space1), Block::parse)),
</span></span><span style="display:flex;"><span>            opt(seq!(_: <span style="color:#a6e22e">Caseless</span>(<span style="color:#e6db74">&#34;NO WAI,&#34;</span>), _: <span style="color:#a6e22e">space1</span>, Block::parse)),
</span></span><span style="display:flex;"><span>            _: <span style="color:#a6e22e">Caseless</span>(<span style="color:#e6db74">&#34;OIC&#34;</span>)
</span></span><span style="display:flex;"><span>        )),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Block</span> <span style="color:#f92672">=</span> Vec<span style="color:#f92672">&lt;</span>Statement<span style="color:#f92672">&gt;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> Scanner <span style="color:#66d9ef">for</span> Expression {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">parse</span>(input: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">mut</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; <span style="color:#a6e22e">PResult</span><span style="color:#f92672">&lt;</span>Expression<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>        alt((
</span></span><span style="display:flex;"><span>            Expression::parse_unary_op,
</span></span><span style="display:flex;"><span>            Expression::parse_binary_op,
</span></span><span style="display:flex;"><span>            Expression::parse_variadic_op,
</span></span><span style="display:flex;"><span>            Expression::parse_literal,
</span></span><span style="display:flex;"><span>            Expression::parse_variable_reference,
</span></span><span style="display:flex;"><span>        )).parse_next(input)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p><code>Expression</code> parser is trying to parse <code>NO</code> and identifies it as standalone variable reference, which should be terminated with <code>,</code> or <code>\n</code>. But instead it finds <code>WAI,</code> and backtracks the entire <code>ya_rly</code> rule. At this point I am not really even sure how to refactor this, and running out of time for today. Will look at it tomorrow :/</p>
<h1 id="day-17">Day 17</h1>
<p>Not much done. Tried to wrap up <code>IF</code> statement, or rather <code>O RLY?</code> statement, but run into several issues with grammar. Looks easy, but need to prepare for tomorrow&rsquo;s talk I voloutneered to give at work about parsing in Rust :) Given the issues with <code>O RLY?</code> I am not sure anymore if I am the best person to give this talk :)</p>
<h1 id="day-16">Day 16</h1>
<p>Parsing day! But first a minor change, I&rsquo;ve decided to move <code>interpolate_string</code> to execution phase. This way, AST holds an original string, and only at execution I am going to interpolate it. And this has to do directly with the fact I don&rsquo;t wanna deal with variable interpolation or breaking down the string into pieces. At execution <code>interpolate_string</code> will get current environment information, and it&rsquo;ll deal with variables directly.</p>
<p>The <code>Scanner</code> trait works nice. Brings clarity to the types:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> Scanner <span style="color:#66d9ef">for</span> Statement {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Item</span> <span style="color:#f92672">=</span> Statement;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">parse</span>(input: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">mut</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; <span style="color:#a6e22e">PResult</span><span style="color:#f92672">&lt;</span>Self::Item<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>        trace(
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;statement&#34;</span>,
</span></span><span style="display:flex;"><span>            alt((
</span></span><span style="display:flex;"><span>                Statement::parse_comment,
</span></span><span style="display:flex;"><span>                Statement::parse_variable_definition,
</span></span><span style="display:flex;"><span>                Statement::parse_variable_assignment,
</span></span><span style="display:flex;"><span>                Statement::parse_output,
</span></span><span style="display:flex;"><span>                Expression::parse.map(<span style="color:#f92672">|</span>v<span style="color:#f92672">|</span> Statement::ExpressionStatement(v)),
</span></span><span style="display:flex;"><span>            )),
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        .parse_next(input)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I&rsquo;m still kind of thinking how to solve parsing statements. LOLCODE has 3 gotchas. Statements are separated by the new line <code>\n</code>, or a comma <code>,</code>. But new line may be broken into another line with <code>...</code>. Oh, and there&rsquo;s single-line comment that does not really need a comma, and both statements are valid:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">VAR</span> <span style="color:#a6e22e">R</span> <span style="color:#ae81ff">10</span>,       <span style="color:#a6e22e">BTW</span> <span style="color:#a6e22e">assign</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">VAR</span> <span style="color:#a6e22e">R</span> <span style="color:#ae81ff">10</span>        <span style="color:#a6e22e">BTW</span> <span style="color:#a6e22e">assign</span>
</span></span></code></pre></div><p>The way I have the grammar of statements works, but it&rsquo;s ugly:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> (statements, _): (Block, _) <span style="color:#f92672">=</span> trace(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;program&#34;</span>,
</span></span><span style="display:flex;"><span>    repeat_till(
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">0</span><span style="color:#f92672">..</span>,
</span></span><span style="display:flex;"><span>        trace(
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;program_statement&#34;</span>,
</span></span><span style="display:flex;"><span>            terminated(
</span></span><span style="display:flex;"><span>                terminated(preceded(space0, Statement::parse), space0),
</span></span><span style="display:flex;"><span>                trace(<span style="color:#e6db74">&#34;command_separator&#34;</span>, alt((<span style="color:#e6db74">&#34;,&#34;</span>, line_ending))),
</span></span><span style="display:flex;"><span>            ),
</span></span><span style="display:flex;"><span>        ),
</span></span><span style="display:flex;"><span>        Program::parse_program_end,
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>.parse_next(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> source)<span style="color:#f92672">?</span>;
</span></span></code></pre></div><p>Will need to refactor this once I get more going, for now I am going to add parsing of flow control, and I think I&rsquo;ll move to execution and actually interpreting the script.</p>
<h1 id="day-15">Day 15</h1>
<p>Literally got like 20 minutes of time, at 11:30pm. After all those refactorings it&rsquo;s time to put this all together. And in order to do this, I need a stack info. Or environment how I chose to call it. So the first draft looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">#[derive(Debug, Clone)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Environment</span> {
</span></span><span style="display:flex;"><span>    variables: <span style="color:#a6e22e">HashMap</span><span style="color:#f92672">&lt;</span>String, Value<span style="color:#f92672">&gt;</span>,
</span></span><span style="display:flex;"><span>    functions: <span style="color:#a6e22e">HashMap</span><span style="color:#f92672">&lt;</span>String, (Vec<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span>, Block)<span style="color:#f92672">&gt;</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> Default <span style="color:#66d9ef">for</span> Environment {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">default</span>() -&gt; <span style="color:#a6e22e">Self</span> {
</span></span><span style="display:flex;"><span>        Self {
</span></span><span style="display:flex;"><span>            variables: <span style="color:#a6e22e">HashMap</span>::new(),
</span></span><span style="display:flex;"><span>            functions: <span style="color:#a6e22e">HashMap</span>::new(),
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> Environment {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">get_variable</span>(<span style="color:#f92672">&amp;</span>self, name: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; Option<span style="color:#f92672">&lt;&amp;</span>Value<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>        self.variables.get(name)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">set_variable</span>(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> self, name: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span>, val: <span style="color:#a6e22e">Value</span>) {
</span></span><span style="display:flex;"><span>        self.variables.insert(name.to_string(), val);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">set_function</span>(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> self, name: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span>, params: Vec<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span>, body: <span style="color:#a6e22e">Block</span>) {
</span></span><span style="display:flex;"><span>        self.functions.insert(name.to_string(), (params, body));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">get_function</span>(<span style="color:#f92672">&amp;</span>self, name: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; Option<span style="color:#f92672">&lt;&amp;</span>(Vec<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span>, Block)<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>        self.functions.get(name)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>While I usually don&rsquo;t like having setters and getters, but I do not plan on allowing to take (move) values from environment, so it actually might be a good idea. But looking at this, I will need an explicit type for functions for sure.</p>
<h1 id="day-14">Day 14</h1>
<p>Yet another refactoring day. After going bottom up with the parsers, I have done some top-down decision on how the enums will look like, so they represent the actual grammar. Not in a PEG sense, but more as an AST. I&rsquo;ve added a <code>Scanner</code> trait (to avoid clash with <code>winnow::Parser</code>. I don&rsquo;t really want to implement the full parser trait) to move all the parsing as <code>impl</code> on the types themselves:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">trait</span> Scanner {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Item</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">parse</span>(input: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">mut</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; <span style="color:#a6e22e">PResult</span><span style="color:#f92672">&lt;</span>Self::Item<span style="color:#f92672">&gt;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I started moved parsing of <code>Value</code> to the new model, and also added <code>From</code> and <code>Display</code> traits. I had to break down <code>Operations</code> into <code>BinaryOp</code> and <code>UnaryOp</code>. Also cleaned up what goes into <code>Statement</code> and <code>Expression</code> types a little. Now I will need to implement all that.</p>
<h1 id="day-13">Day 13</h1>
<p>Friday 13th. What can go wrong? :)</p>
<p>Did some updates to my home page. Added recent publication, and the panel discussion. And figured I might as well do some long outstanding fixes :)</p>
<p>First of all, I&rsquo;ve finally applied styling to <code>&lt;code&gt;</code> based on <a href="http://izzys.casa">Izzy&rsquo;s Casa</a>. There&rsquo;s a recent article on the state of C++ Committee rot, and as good as the article was, couple of the styling tricks stole my heart therefore I am stealing them :)</p>
<p>I had to experiment a little with it in my setup, because <code>&lt;code&gt;</code> is used for inline-backticked verbatim code, as well as code blocks. I didn&rsquo;t want to mess with background and shadows for the latter, so I had to find a way to leave them alone. Fortunately they all have a <code>class</code> attribute starting with <code>language-</code>, like <code>class=&quot;language-rust&quot;</code>. From there it was realtively easy, once I brushed up on CSS selectors:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scss" data-lang="scss"><span style="display:flex;"><span>$box-shadow-xsmall<span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">0</span><span style="color:#66d9ef">px</span> <span style="color:#ae81ff">0</span><span style="color:#66d9ef">px</span> $code-foreground-color;
</span></span><span style="display:flex;"><span>$border-small<span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span> solid $code-foreground-color;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">code</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">:not</span><span style="color:#f92672">([</span><span style="color:#f92672">class</span><span style="color:#f92672">^=</span><span style="color:#e6db74">&#34;language-&#34;</span><span style="color:#f92672">])</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">background-color</span><span style="color:#f92672">:</span> $code-background-color;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> $code-foreground-color;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">border</span><span style="color:#f92672">:</span> $border-small;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">box-shadow</span><span style="color:#f92672">:</span> $box-shadow-xsmall;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">line-height</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span><span style="color:#ae81ff">.2</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">margin-left</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">margin-right</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span><span style="color:#66d9ef">px</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">padding</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span><span style="color:#ae81ff">.1</span><span style="color:#66d9ef">rem</span> <span style="color:#ae81ff">0</span><span style="color:#ae81ff">.2</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">vertical-align</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">10</span><span style="color:#66d9ef">%</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">font-family</span><span style="color:#f92672">:</span> $font-family-code;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">font-optical-sizing</span><span style="color:#f92672">:</span> auto;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">font-style</span><span style="color:#f92672">:</span> normal;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">font-weight</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">500</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">font-size</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">0</span><span style="color:#ae81ff">.95</span><span style="color:#66d9ef">rem</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I&rsquo;ve also added a cool decay effect on pictures, that I saw in an article <a href="https://lil.law.harvard.edu/century-scale-storage/">Century-Scale Storage</a> by Maxwell Neely-Cohen. It&rsquo;s a great piece on so many levels. First of all it touches a subject dear to my heart for the past few years, ever since I started <a href="https://kskpd.pl/en/projects/polish-entry-to-unesco/">the UNESCO journey</a> which is preservation of digital heritage. But also because it was quite neat on the presentation layer. There&rsquo;s many custom shaders, custom p5 animations, and this one effect that wen you scroll, the image seems to vanish in digital noise.</p>
<p>The effect is quite easy actually to pull of. First you need a canvas layer overlay fixed at the top:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">canvas</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;decay-canvas&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;3172&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;440&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;height: 220px; width: 1586px&#34;</span>
</span></span><span style="display:flex;"><span>&gt;&lt;/<span style="color:#f92672">canvas</span>&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#decay-canvas {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">position</span>: <span style="color:#66d9ef">fixed</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">top</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">left</span>: <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">100</span><span style="color:#66d9ef">%</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">z-index</span>: <span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>then you need all your text to have <code>z-index</code> higher than the overlay and your images. The images stay below, that way the overlay does seem to impact only the images. Then you need a little script like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">decay</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;decay-canvas&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pixelSize</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">innerWidth</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1600</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">innerWidth</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">440</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;px&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;px&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ctx</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#34;2d&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">fillStyle</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#fff&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">clearRect</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>, <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">j</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span>; <span style="color:#a6e22e">j</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">pixelSize</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">probability</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">pow</span>(
</span></span><span style="display:flex;"><span>      (<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">j</span>) <span style="color:#f92672">/</span> (<span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">height</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">width</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">pixelSize</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (Math.<span style="color:#a6e22e">random</span>() <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">probability</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ctx</span>.<span style="color:#a6e22e">fillRect</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">j</span>, <span style="color:#a6e22e">pixelSize</span>, <span style="color:#a6e22e">pixelSize</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>The coders behind the article were nice enough to include one little trick I have not seen before. Which proves nothing, because I am not a front-end person, but it was interesting to me. The trick is to fetch the user preferences regarding <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-reduced-motion">reduced motion</a>. It is something available via css media queries like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>@<span style="color:#66d9ef">media</span> <span style="color:#f92672">(</span><span style="color:#f92672">prefers-reduced-motion</span><span style="color:#f92672">)</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/* styles to apply if a user&#39;s device settings are set to reduced motion */</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I have not personally used that one. In media queries I really only used resolution so far, but also I didn&rsquo;t know that it&rsquo;s easy to fetch them from javascript. And since it is, it&rsquo;s really a kind thing to do for your viewers:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>window.<span style="color:#a6e22e">isReducedMotion</span> <span style="color:#f92672">=</span> () =&gt;
</span></span><span style="display:flex;"><span>  window.<span style="color:#a6e22e">matchMedia</span>(<span style="color:#e6db74">`(prefers-reduced-motion: reduce)`</span>) <span style="color:#f92672">===</span> <span style="color:#66d9ef">true</span> <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>  window.<span style="color:#a6e22e">matchMedia</span>(<span style="color:#e6db74">`(prefers-reduced-motion: reduce)`</span>).<span style="color:#a6e22e">matches</span> <span style="color:#f92672">===</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   window.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>     <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">isReducedMotion</span>()) {
</span></span><span style="display:flex;"><span>       <span style="color:#a6e22e">decay</span>();
</span></span><span style="display:flex;"><span>     }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     document.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;resize&#34;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">isReducedMotion</span>()) {
</span></span><span style="display:flex;"><span>         <span style="color:#a6e22e">decay</span>();
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>     });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     document.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;scroll&#34;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">isReducedMotion</span>()) {
</span></span><span style="display:flex;"><span>         <span style="color:#a6e22e">decay</span>();
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>     });
</span></span><span style="display:flex;"><span>   };
</span></span></code></pre></div><h1 id="day-12">Day 12</h1>
<p>Today I was traveling to Warsaw, for a conference called <a href="https://midi2024.opi.org.pl">12th Machine Intelligence and Digital Interaction</a>. I had one paper accepted for it, but also the organizers were kind enough to invite me for a panel discussion on digital heritage in architecture and arts.</p>


  <figure>
  <img src="images/IMG_3064.jpg" alt="A photo of the conference&#39;s chair announcing a panel discussion. In the background a huge screen with logo of the conference, and panel information"/>
  </figure>
  <div class="caption">
    <p>MIDI Conference</p>
    <p class="photo-attribution">photo done by author.</p>
  </div>


<p>Met couple cool people including professors Wiesław Kopeć from XR Center at <a href="http://pja.edu.pl">PJAT</a> and Władek Fuchs from <a href="https://volterra-detroit.org">Volterra-Detroit Foundation</a>.</p>
<p>I have also spent a great time with my favorite man behind <a href="https://fhkd.pl">The Foundation for the History of Home Computers</a> - <a href="https://arxiv.org/search/cs?searchtype=author&amp;query=Grzeszczuk,&#43;M">Maciej Grzeszczuk</a>, and the remaining 0.33 of our lil&rsquo; informal research team &ndash; <a href="https://arxiv.org/search/cs?searchtype=author&amp;query=Skorupska,&#43;K">Kinga Skorupska</a>. Love those guys, srsly. Coming back with at least 2 great ideas. Must. Not. Distract. :)</p>
<p>Train back home was announced to be 15 minutes late, but eventually came after 45. Disaster.</p>
<h1 id="day-11">Day 11</h1>
<p>Not much time today. Renamed <code>Token</code> to <code>Node</code>. I was thinking of naming it <code>Expression</code> but it didn&rsquo;t sit right, as some of the enum variants were in reality just statements&hellip;</p>
<p>I&rsquo;ve also added a simple <code>Node</code> wrapper for <code>Value</code>, that I actually hate, as it looks ugly, and I am going to refactor it soon hopefully. For now it&rsquo;s enough tho:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">pub</span>(<span style="color:#66d9ef">crate</span>) <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">parse_value</span>(input: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">mut</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; <span style="color:#a6e22e">PResult</span><span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    trace(<span style="color:#e6db74">&#34;value&#34;</span>, Value::parse)
</span></span><span style="display:flex;"><span>        .map(<span style="color:#f92672">|</span>v<span style="color:#f92672">|</span> Node::Value(v.unwrap()))
</span></span><span style="display:flex;"><span>        .parse_next(input)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And that should enable working on actual expressions, operators and function calls.</p>
<h1 id="day-10">Day 10</h1>
<p>A little bit more of refactoring. Decided to pull parsing functions into the type for both <code>Value</code> and <code>Token</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> Value {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pub</span>(<span style="color:#66d9ef">crate</span>) <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">parse</span>(input: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">mut</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; <span style="color:#a6e22e">PResult</span><span style="color:#f92672">&lt;</span>Option<span style="color:#f92672">&lt;</span>Self<span style="color:#f92672">&gt;&gt;</span> {
</span></span><span style="display:flex;"><span>        trace(
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;value&#34;</span>,
</span></span><span style="display:flex;"><span>            alt((
</span></span><span style="display:flex;"><span>                Self::parse_float_dot,
</span></span><span style="display:flex;"><span>                Self::parse_uint,
</span></span><span style="display:flex;"><span>                Self::parse_string,
</span></span><span style="display:flex;"><span>                Self::parse_boolean,
</span></span><span style="display:flex;"><span>                Self::parse_undefined,
</span></span><span style="display:flex;"><span>            )),
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        .map(<span style="color:#f92672">|</span>v<span style="color:#f92672">|</span> Ok(v))
</span></span><span style="display:flex;"><span>        .parse_next(input)<span style="color:#f92672">?</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h1 id="day-09">Day 09</h1>
<p>Had to do a little bit of refactoring. I never understood why some Rust library authors prefer to stuff 100k of code straight into <code>lib.rs</code>. It always felt weird, and unsettling. I like my files broken down. So when my interpreter started to approach 500 LOC, I had to split it into several files.</p>
<p>Now that I have proper values, as well as variables that can hold values, I figured I need a trait for things that can be turned into value. In the mean time, I had to look up the syntax for matching structure enums&hellip; that&rsquo;s definietely not overly intuitive, but looks pretty after a while:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> ToValue <span style="color:#66d9ef">for</span> Token {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">to_value</span>(<span style="color:#f92672">&amp;</span>self) -&gt; <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">Value</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">match</span> self {
</span></span><span style="display:flex;"><span>            Token::Variable {
</span></span><span style="display:flex;"><span>                value: Some(<span style="color:#66d9ef">ref</span> v), <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>            } <span style="color:#f92672">=&gt;</span> v,
</span></span><span style="display:flex;"><span>            _ <span style="color:#f92672">=&gt;</span> unreachable!(),
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="day-08">Day 08</h1>
<p>A day of string interpolation. In the meantime, I&rsquo;ve learned that Rust does not understand <code>\g</code>. But maybe that&rsquo;s for the better&hellip; who&rsquo;d use that in 2024 anyway?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">test_string_interpolate</span>() {
</span></span><span style="display:flex;"><span>    assert_eq!(interpolate_from(<span style="color:#e6db74">&#34;:)&#34;</span>), <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>.to_string());
</span></span><span style="display:flex;"><span>    assert_eq!(interpolate_from(<span style="color:#e6db74">&#34;:):&gt;&#34;</span>), <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n\t</span><span style="color:#e6db74">&#34;</span>.to_string());
</span></span><span style="display:flex;"><span>    assert_eq!(interpolate_from(<span style="color:#e6db74">&#34;:o&#34;</span>), <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x07</span><span style="color:#e6db74">&#34;</span>.to_string());
</span></span><span style="display:flex;"><span>    assert_eq!(interpolate_from(<span style="color:#e6db74">&#34;:</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span>), <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span>.to_string());
</span></span><span style="display:flex;"><span>    assert_eq!(interpolate_from(<span style="color:#e6db74">&#34;::&#34;</span>), <span style="color:#e6db74">&#34;:&#34;</span>.to_string());
</span></span><span style="display:flex;"><span>    assert_eq!(interpolate_from(<span style="color:#e6db74">&#34;:(70)&#34;</span>), <span style="color:#e6db74">&#34;p&#34;</span>.to_string());
</span></span><span style="display:flex;"><span>    assert_eq!(interpolate_from(<span style="color:#e6db74">&#34;:(70):(6F)&#34;</span>), <span style="color:#e6db74">&#34;po&#34;</span>.to_string());
</span></span><span style="display:flex;"><span>    assert_eq!(
</span></span><span style="display:flex;"><span>        interpolate_from(<span style="color:#e6db74">&#34;:[black star]:[snowman]:[black star]&#34;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;★☃★&#34;</span>.to_string()
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    assert_eq!(
</span></span><span style="display:flex;"><span>        interpolate_from(<span style="color:#e6db74">&#34;:):(70):::&gt;:[black star]:(6F):[snowman]::&#34;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">p:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">★o☃:&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span></code></pre></div><h1 id="day-07">Day 07</h1>
<p>A little context switch again. Riddle for <a href="https://adventofcode.com/2024/day/4">day four</a> of advent code bothered me for some time now. It was easy to solve it in imperative way, but I really wanted to solve it in racket in a way that will be generic for both parts.</p>
<p>So first we define the patterns. I wanted to describe both searches in a purely declarative manner:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> part-1-pattern <span style="color:#f92672">&#39;</span>((<span style="color:#e6db74">#\X</span> <span style="color:#e6db74">&#34;XMAS&#34;</span>
</span></span><span style="display:flex;"><span>        (((<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">3</span>))
</span></span><span style="display:flex;"><span>         ((<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>         ((<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">2</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span>))
</span></span><span style="display:flex;"><span>         ((<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">-1</span>) (<span style="color:#ae81ff">2</span> <span style="color:#ae81ff">-2</span>) (<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">-3</span>))
</span></span><span style="display:flex;"><span>         ((<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">-1</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">-2</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">-3</span>))
</span></span><span style="display:flex;"><span>         ((<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">-2</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">-3</span> <span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>         ((<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">-1</span>) (<span style="color:#ae81ff">-2</span> <span style="color:#ae81ff">-2</span>) (<span style="color:#ae81ff">-3</span> <span style="color:#ae81ff">-3</span>))
</span></span><span style="display:flex;"><span>         ((<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">-2</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">-3</span> <span style="color:#ae81ff">3</span>))))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> part-2-pattern <span style="color:#f92672">&#39;</span>(
</span></span><span style="display:flex;"><span>  (<span style="color:#e6db74">#\A</span> <span style="color:#e6db74">&#34;MASMAS&#34;</span> (((<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">-1</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">-1</span>))))
</span></span><span style="display:flex;"><span>  (<span style="color:#e6db74">#\A</span> <span style="color:#e6db74">&#34;MASSAM&#34;</span> (((<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">-1</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">-1</span>))))
</span></span><span style="display:flex;"><span>  (<span style="color:#e6db74">#\A</span> <span style="color:#e6db74">&#34;SAMMAS&#34;</span> (((<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">-1</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">-1</span>))))))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Then some helpers, to get the size of the grid&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (grid-size grid)
</span></span><span style="display:flex;"><span>  (list (string-length (car grid)) (length grid)))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>&hellip; to check if coordinates are valid&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (coord-valid? xy height width)
</span></span><span style="display:flex;"><span>  (not (<span style="color:#66d9ef">or</span> (&lt; (car xy) <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>           (&gt;= (car xy) width)
</span></span><span style="display:flex;"><span>           (&lt; (cadr xy) <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>           (&gt;= (cadr xy) height))))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>&hellip; and finally to get a character under at the coords, or <code>false</code> if coords are out of bounds.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (coord-get grid xy width height)
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">if</span> (coord-valid? xy width height)
</span></span><span style="display:flex;"><span>      (string-ref (list-ref grid (car xy)) (cadr xy))
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">#f</span>))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Next, I loop through the patterns. For every pattern I try to get the characters under the coords. I further process only the strings that are fully fetched &ndash; i.e. they have as many characters as coords in the pattern &ndash; and I return the list with the strings for each pattern matched.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (patterns-&gt;characters grid xy width height patterns)
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">let*</span> ([valid? <span style="color:#66d9ef">#t</span>]
</span></span><span style="display:flex;"><span>         [result <span style="color:#f92672">&#39;</span>()]
</span></span><span style="display:flex;"><span>         [bind-coord-get (<span style="color:#66d9ef">lambda</span> (bind-xy)
</span></span><span style="display:flex;"><span>                           (coord-get grid
</span></span><span style="display:flex;"><span>                                      (list (+ (car xy) (car bind-xy))
</span></span><span style="display:flex;"><span>                                            (+ (cadr xy) (cadr bind-xy)))
</span></span><span style="display:flex;"><span>                                      width
</span></span><span style="display:flex;"><span>                                      height))])
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">define</span> (pattern-&gt;characters pattern)
</span></span><span style="display:flex;"><span>      (<span style="color:#66d9ef">let*</span> ([result (filter-map bind-coord-get pattern)]
</span></span><span style="display:flex;"><span>             [pattern-len (length pattern)]
</span></span><span style="display:flex;"><span>             [result-len (length result)])
</span></span><span style="display:flex;"><span>        (<span style="color:#66d9ef">if</span> (equal? pattern-len result-len) result <span style="color:#66d9ef">#f</span>)))
</span></span><span style="display:flex;"><span>    (map list-&gt;string (filter-map pattern-&gt;characters patterns))))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>And here&rsquo;s the main loop. Going through the grid, I look for the character defined in the pattern. If I find one, I get all the strings defined by the pattern coords. Then I sum how many of those strings I&rsquo;ve found actually matched a given pattern.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (solve-pattern grid pattern)
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">let*</span> ([result <span style="color:#f92672">&#39;</span>()]
</span></span><span style="display:flex;"><span>         [debug-result <span style="color:#f92672">&#39;</span>()]
</span></span><span style="display:flex;"><span>         [size (grid-size grid)]
</span></span><span style="display:flex;"><span>         [width (car size)]
</span></span><span style="display:flex;"><span>         [height (cadr size)]
</span></span><span style="display:flex;"><span>         [search-char (car pattern)]
</span></span><span style="display:flex;"><span>         [search-string (cadr pattern)]
</span></span><span style="display:flex;"><span>         [search-pattern (caddr pattern)]
</span></span><span style="display:flex;"><span>         [is-search-string?
</span></span><span style="display:flex;"><span>          (<span style="color:#66d9ef">lambda</span> (x)
</span></span><span style="display:flex;"><span>            (<span style="color:#66d9ef">or</span> (equal? x search-string)
</span></span><span style="display:flex;"><span>                (equal? (list-&gt;string (reverse (string-&gt;list x)))
</span></span><span style="display:flex;"><span>                        search-string)))])
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">for*</span> ([x (in-range height)]
</span></span><span style="display:flex;"><span>           [y (in-range width)])
</span></span><span style="display:flex;"><span>      (<span style="color:#66d9ef">when</span> (char=? search-char (coord-get grid (list x y) width height))
</span></span><span style="display:flex;"><span>        (<span style="color:#66d9ef">set!</span>
</span></span><span style="display:flex;"><span>         result
</span></span><span style="display:flex;"><span>         (cons (length (filter identity
</span></span><span style="display:flex;"><span>                               (map is-search-string?
</span></span><span style="display:flex;"><span>                                    (patterns-&gt;characters grid
</span></span><span style="display:flex;"><span>                                                          (list x y)
</span></span><span style="display:flex;"><span>                                                          width
</span></span><span style="display:flex;"><span>                                                          height
</span></span><span style="display:flex;"><span>                                                          search-pattern))))
</span></span><span style="display:flex;"><span>               result))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    (apply + result)))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Finally I sum all the sums, to get the final hit number. In the begining, this was only one loop. The core function was the one above, but I didn&rsquo;t find a feasable way to get Part 2 working with one <em>search string</em>. That&rsquo;s why eventually the pattern became a list of patterns.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (solve grid patterns)
</span></span><span style="display:flex;"><span>  (apply + (map (<span style="color:#66d9ef">lambda</span> (x) (solve-pattern grid x)) patterns)))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>And the formalities, print out the answers.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (main)
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">let*</span> ([input (port-&gt;string (open-input-file <span style="color:#e6db74">&#34;day04.txt&#34;</span>) <span style="color:#66d9ef">#:close?</span> <span style="color:#66d9ef">#t</span>)]
</span></span><span style="display:flex;"><span>         [grid (string-split input <span style="color:#e6db74">#px&#34;\n&#34;</span>)])
</span></span><span style="display:flex;"><span>    (printf <span style="color:#e6db74">&#34;Total XMAS: ~a</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> (solve grid part-1-pattern))
</span></span><span style="display:flex;"><span>    (printf <span style="color:#e6db74">&#34;Total X-MAS: ~a</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> (solve grid part-2-pattern))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(main)<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>It ain&rsquo;t pretty. Functional mindset was a long dream of mine, but it is apparent that it is hard for me to unlearn imperative ways.</p>
<h1 id="day-06">Day 06</h1>
<p>Not much time today either. Work, Xmas Party afterhours, and setting up cookies and milk for Santa with the kids, but also a trap to catch him in the act :)</p>
<p>Still I managed to add parsing for following sections of 1.2 spec:</p>
<ul>
<li>File Creation</li>
<li>Comments</li>
<li>Variables</li>
</ul>
<p>More updates tomorrow.</p>
<h1 id="day-05">Day 05</h1>
<p>Today was a busy day, couldn&rsquo;t spend too much time off work. But did manage to think through, or at least to take a stab at the last missing piece I think I need, which is:</p>
<h2 id="file-io">File I/O</h2>
<ol>
<li>Open a file</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">I</span> <span style="color:#a6e22e">HAS</span> <span style="color:#a6e22e">A</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">file_handle</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">ITZ</span> <span style="color:#a6e22e">SHIP</span> <span style="color:#e6db74">&#34;&lt;filename&gt;&#34;</span> <span style="color:#a6e22e">WIF</span> <span style="color:#e6db74">&#34;&lt;mode&gt;&#34;</span>
</span></span></code></pre></div><p>Mode can be:</p>
<ul>
<li><code>SNAGGING</code>: read mode</li>
<li><code>SLAPIN</code>: write mode, truncates file</li>
<li><code>ADDIN</code>: append mode</li>
</ul>
<p>all file input/output is done assuming text-mode. No support for binary yet.</p>
<ol start="2">
<li>Read from a file</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">SLURP</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">variable</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">OFFA</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">file_handle</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><ol start="3">
<li>Write to a file</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">SCOOP</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">data</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">IN2</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">file_handle</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><p>The command <code>VISIBLE &lt;data&gt;</code> is a backwards compatible equivalent of <code>SCOOP &lt;data&gt; IN2 MAHOUT</code>.</p>
<ol start="4">
<li>Close the file</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">UNSHIP</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">file_handle</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><ol start="5">
<li>Predefined file handles</li>
</ol>
<p>As in many systems, LULZ comes with predefined handles for standard streams;</p>
<ul>
<li>stdio is <code>MAHIN</code></li>
<li>stdout is <code>MAHOUT</code></li>
<li>stderr is <code>MAHBAD</code></li>
</ul>
<p>you can use them in place of <code>file_handle</code></p>
<h1 id="day-04">Day 04</h1>
<p>Oh dear attention deficit&hellip; today isn&rsquo;t my day with Scheme. To be honest, it&rsquo;s one of those days where everything I touch turns to sh*t. So, I needed something fun. The chain of events that led me here is completely random, but in the end, I stumbled upon LOLCODE! It’s so appealing, in a very weird way, and still&hellip;</p>
<p>The only problem with this language is its age &ndash; it&rsquo;s almost 15 years old. That nearly qualifies as retro; there are things in museums that are just as old. The issue isn&rsquo;t necessarily its age but the fact that the authors never fully standardized certain aspects of it. What I really need are arrays and file input/output capabilities. So here&rsquo;s my attempt at the spec, and interpreter might follow soon ;)</p>
<h2 id="arrays">Arrays</h2>
<ol>
<li>Empty array declaration</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">I</span> <span style="color:#a6e22e">HAS</span> <span style="color:#a6e22e">A</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">array_name</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">ITZ</span> <span style="color:#a6e22e">A</span> <span style="color:#a6e22e">BUKKIT</span>
</span></span></code></pre></div><ol start="2">
<li>Array with initial values</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">I</span> <span style="color:#a6e22e">HAS</span> <span style="color:#a6e22e">A</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">array_name</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">ITZ</span> <span style="color:#a6e22e">A</span> <span style="color:#a6e22e">BUKKIT</span> <span style="color:#a6e22e">WIF</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">value1</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">AN</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">value2</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">AN</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">value3</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">MKAY</span>
</span></span></code></pre></div><ol start="3">
<li>Is array empty?</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">IZ</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">array_name</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">GHOST</span><span style="color:#960050;background-color:#1e0010">?</span>
</span></span></code></pre></div><ol start="4">
<li>Getting array size</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">HOW</span> <span style="color:#a6e22e">BIG</span> <span style="color:#a6e22e">IZ</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">array_name</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><ol start="5">
<li>Retrieving an item from array</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">I</span> <span style="color:#a6e22e">HAS</span> <span style="color:#a6e22e">A</span> <span style="color:#a6e22e">ma_value</span> <span style="color:#a6e22e">ITZ</span> <span style="color:#a6e22e">ma_numbers</span> <span style="color:#a6e22e">LOK</span> <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><ol start="6">
<li>Appending value at the end of array</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">YEET</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">value</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">LOK</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">array_name</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><ol start="7">
<li>Updating value at the index</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">YEET</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">value</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">INDA</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">array_name</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">LOK</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">index</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><ol start="8">
<li>Removing element at index</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">BAI</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">array_name</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">LOK</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">index</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><ol start="9">
<li>
<p>Iterating over array</p>
<p>A label in the <code>IM IN YR &lt;label&gt;</code> for-loop defined in <a href="https://github.com/justinmeza/lolcode-spec/blob/master/v1.2/lolcode-spec-v1.2.md">1.2 version of the spec</a> is not used, and I was tempted to re-use it, but at the end of the day, I think a dedicated loop fits here:</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">FORE4CH</span> <span style="color:#a6e22e">YR</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">item_variable</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">IN</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">array_name</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">statements</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">KTH</span>
</span></span></code></pre></div><p>And that&rsquo;s it for now. In the mean time I am working on implementing basics of 1.2 spec using <a href="https://docs.rs/winnow/latest/winnow/">winnow</a> and Rust:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">parse_program_begin</span>(input: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">mut</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; Result {
</span></span><span style="display:flex;"><span>    seq!(Token::Hai{
</span></span><span style="display:flex;"><span>        _: <span style="color:#e6db74">&#34;HAI&#34;</span>,
</span></span><span style="display:flex;"><span>        _: <span style="color:#a6e22e">space1</span>,
</span></span><span style="display:flex;"><span>        major: <span style="color:#a6e22e">dec_uint</span>,
</span></span><span style="display:flex;"><span>        _: <span style="color:#e6db74">&#34;.&#34;</span>,
</span></span><span style="display:flex;"><span>        minor: <span style="color:#a6e22e">dec_uint</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .parse_next(input)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">parse_program_end</span>(input: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">mut</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; Result {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;KTHXBAI&#34;</span>.map(<span style="color:#f92672">|</span>_<span style="color:#f92672">|</span> Ok(Token::Kthxbai)).parse_next(input)<span style="color:#f92672">?</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="day-03">Day 03</h1>
<p>Slowly everything starts coming together. The ports turned out to be quite simple, and intuitive. They&rsquo;re just a <code>HANDLE</code>, an abstraction of input used by other read/write functions. The lexer is not bad either, follows similar pattern to <code>cond</code> or <code>match-string</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(define-lex-abbrev CRLF (seq <span style="color:#e6db74">#\return</span> <span style="color:#e6db74">#\newline</span>))
</span></span><span style="display:flex;"><span>(define-lex-abbrev NEWLINE (<span style="color:#66d9ef">or</span> CRLF <span style="color:#e6db74">#\return</span> <span style="color:#e6db74">#\newline</span>))
</span></span><span style="display:flex;"><span>(define-lex-abbrev BACKSLASH-NEWLINE (seq <span style="color:#e6db74">#\\</span> NEWLINE))
</span></span><span style="display:flex;"><span>(define-lex-abbrev ANY-NEWLINE (<span style="color:#66d9ef">or</span> BACKSLASH-NEWLINE NEWLINE))
</span></span><span style="display:flex;"><span>(define-lex-abbrev ANY-CHAR (char-complement (union)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> lex 
</span></span><span style="display:flex;"><span>  (lexer 
</span></span><span style="display:flex;"><span>    [(eof) <span style="color:#f92672">&#39;</span><span style="color:#e6db74">EOF</span>] 
</span></span><span style="display:flex;"><span>    [ANY-NEWLINE (lex input-port)] 
</span></span><span style="display:flex;"><span>    [ANY-CHAR (display lexeme)]))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (run-lexer port) 
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">when</span> (not (eq? <span style="color:#f92672">&#39;</span><span style="color:#e6db74">eof</span> (lex port))) (run-lexer port)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (main)
</span></span><span style="display:flex;"><span>  (run-lexer (open-input-string <span style="color:#e6db74">&#34;_</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">FI</span><span style="color:#ae81ff">\\\n</span><span style="color:#e6db74">LE</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">__&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">module+</span> main
</span></span><span style="display:flex;"><span>  (main))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>now that I have this out of the way, I am going to do something I haven&rsquo;t done in a long time - I am going to use the <a href="https://gcc.gnu.org/onlinedocs/cpp/">manual</a> and implement the preprocessor according to the rules :)</p>
<h1 id="day-02">Day 02</h1>
<p>Not much time today, so didn&rsquo;t really managed to write any code towards the preprocessor. I was also still having a kind of inner battle between heart (Scheme) and reason (Rust). Not sure if that&rsquo;s a victory, but heart still wins :)</p>
<p>I&rsquo;ve never really studied parsers. I think I am aware enough to appreciate the complexities and subtlety that goes into them, but throughout my career I only did very naive handmade parsers, then used <a href="https://www.boost.org/doc/libs/1_85_0/libs/spirit/doc/html/index.html">Spirit</a> quite a lot &ndash; and frankly loved it! &ndash; and then used some Parser Expression Grammars like <a href="https://docs.rs/nom/latest/nom/">nom</a> or <a href="https://docs.rs/winnow/latest/winnow/">winnow</a>. I must admit tho, that I find PEGs a little confusing&hellip; the first-match wins rule never won my heart. I think in backtracking terms&hellip;</p>
<p>Also, since I really only picked up Scheme like 2-3 days ago, every piece of documentation I read, opens another doors to yet another new concept. Like I tried to delay learning <code>input-ports</code> and kept operating on strings as long as I could, but with lexer it was inevitable. So here I am, going down a rabbit hole&hellip; :)</p>
<h1 id="day-01">Day 01</h1>
<p>I have few projects in my head, I was trying to <del>finish</del>, who am I kidding, I was trying to even start them, for a long, long time. I am not going to write about the end goal yet, as I am not sure how long I am going to last, but for now, I want to focus on writing a C preprocessor. But also, I really wanna write it in Scheme. Or maybe I should rather say Racket. And to start well, here&rsquo;s a little <a href="https://adventofcode.com">Advent of Code</a> I did, my first Scheme in &ldquo;production&rdquo;:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (parse-input lines)
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">for/fold</span> ([left-list <span style="color:#f92672">&#39;</span>()]
</span></span><span style="display:flex;"><span>             [right-list <span style="color:#f92672">&#39;</span>()])
</span></span><span style="display:flex;"><span>            ([line lines])
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">let*</span> ([parts (map string-&gt;number (regexp-split <span style="color:#e6db74">#px&#34;\\s+&#34;</span> line))]
</span></span><span style="display:flex;"><span>           [left (first parts)]
</span></span><span style="display:flex;"><span>           [right (second parts)])
</span></span><span style="display:flex;"><span>      (values (cons left left-list) (cons right right-list)))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (read-input filename)
</span></span><span style="display:flex;"><span>  (parse-input (file-&gt;lines filename)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (calculate-total-distance left right)
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">letrec</span> ([calculate (<span style="color:#66d9ef">lambda</span> (l r a)
</span></span><span style="display:flex;"><span>                        (<span style="color:#66d9ef">cond</span>
</span></span><span style="display:flex;"><span>                          [(<span style="color:#66d9ef">or</span> (empty? l) (empty? r)) a]
</span></span><span style="display:flex;"><span>                          [<span style="color:#66d9ef">else</span> (calculate (rest l) (rest r) (+ a (abs (- (first l) (first r)))))]))])
</span></span><span style="display:flex;"><span>    (calculate (sort left &lt;) (sort right &lt;) <span style="color:#ae81ff">0</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (calculate-similarity-score left right)
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">let</span> ([frequency-map (make-hash)])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">for</span> ([num right])
</span></span><span style="display:flex;"><span>      (hash-set! frequency-map num (+ (hash-ref frequency-map num <span style="color:#ae81ff">0</span>) <span style="color:#ae81ff">1</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">for/fold</span> ([acc <span style="color:#ae81ff">0</span>]) ([num left])
</span></span><span style="display:flex;"><span>      (+ acc (* num (hash-ref frequency-map num <span style="color:#ae81ff">0</span>))))))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>I already know it might be better, and I&rsquo;ll polish it tomorrow. It&rsquo;s kinda getting late, and I wanted to get this post out. G&rsquo;nite :)</p>
 
          <div class="comments">
            <h2>Comments</h2>
            <p>
              Discussion powered by <i class="fa-brands fa-mastodon"></i>,
              <a href="https://mastodon.gamedev.place/@unjello/113580023530866158"
                >hop in.</a
              >
              if you want.
            </p>
            <div id="comments"></div>
          </div>
          <script>
            (async function () {
              const commentsDiv = document.getElementById("comments");
              const statusId = "113580023530866158";
              const mastodonInstance = "mastodon.gamedev.place";
              const contextUrl = `https://${mastodonInstance}/api/v1/statuses/${statusId}/context`;

              try {
                const response = await fetch(contextUrl);

                if (!response.ok) {
                  throw new Error(
                    "Network response was not ok " + response.statusText,
                  );
                }

                const context = await response.json();
                const comments = context.descendants;
                comments.forEach((comment) => {
                  const commentElement = document.createElement("div");
                  commentElement.classList.add("comment");

                  const authorName = DOMPurify.sanitize(
                    comment.account.display_name || comment.account.username,
                  );
                  const authorUrl = DOMPurify.sanitize(comment.account.url);
                  const content = DOMPurify.sanitize(comment.content);
                  const avatarUrl = DOMPurify.sanitize(
                    comment.account.avatar_static || comment.account.avatar,
                  );
                  const createdAt = new Date(comment.created_at);
                  const timestamp = createdAt.toLocaleString();

                  const avatarImg = document.createElement("img");
                  avatarImg.src = avatarUrl;
                  avatarImg.alt = `${authorName}'s avatar`;
                  avatarImg.classList.add("avatar");

                  const contentDiv = document.createElement("div");
                  contentDiv.classList.add("comment-content");

                  const headerDiv = document.createElement("div");
                  headerDiv.classList.add("comment-header");

                  const authorLink = document.createElement("a");
                  authorLink.href = authorUrl;
                  authorLink.target = "_blank";
                  authorLink.textContent = authorName;

                  const timeSpan = document.createElement("span");
                  timeSpan.classList.add("timestamp");
                  timeSpan.textContent = `• ${timestamp}`;

                  headerDiv.appendChild(authorLink);
                  headerDiv.appendChild(timeSpan);

                  const bodyDiv = document.createElement("div");
                  bodyDiv.classList.add("comment-body");
                  bodyDiv.innerHTML = content;

                  contentDiv.appendChild(headerDiv);
                  contentDiv.appendChild(bodyDiv);

                  commentElement.appendChild(avatarImg);
                  commentElement.appendChild(contentDiv);

                  commentsDiv.appendChild(commentElement);
                });
              } catch (error) {
                console.error("Error fetching comments:", error);
                commentsDiv.innerHTML = "<p>Error loading comments.</p>";
              }
            })();
          </script>
          
        </div>
      </section>
      <script>
        
        (function addTitleToCodeBlock() {
          let list = document.body.getElementsByClassName("highlight");

          for (i = 0; i <= list.length - 1; i++) {
            let code = list[i].firstElementChild.firstElementChild;
            let codeName = code ? code.className.split(":")[1] : null;

            if (codeName) {
              console.log(codeName);
              let div = document.createElement("div");
              div.textContent = codeName;
              div.classList.add("code-name");
              code.parentNode.insertBefore(div, code);
            }
          }
        })();
      </script>

      <footer class="fs-6 text-muted mt-5">
        <p>
          CC0. Powered by <a href="https://gohugo.io">Hugo</a>. Theme inspired
          by <a href="https://www.mattdesl.com/">@mattdesl</a> and
          <a href="https://ozafoto.com/digital/">Oza</a>.
        </p>
      </footer>
    </div>
  </body>
  <script type="text/javascript">
    

    function decay() {
      const canvas = document.getElementById("decay-canvas");
      const pixelSize = window.innerWidth > 1600 ? 8 : 6;

      canvas.width = window.innerWidth * 2;
      canvas.height = 440;
      canvas.style.height = canvas.height / 2 + "px";
      canvas.style.width = canvas.width / 2 + "px";
      const ctx = canvas.getContext("2d");
      ctx.fillStyle = "#fff";
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let j = 0; j < canvas.height; j += pixelSize) {
        const probability = Math.pow(
          (canvas.height - 1 - j) / (canvas.height - 1),
          3,
        );
        for (let i = 0; i < canvas.width; i += pixelSize) {
          if (Math.random() < probability) {
            ctx.fillRect(i, j, pixelSize, pixelSize);
          }
        }
      }
    }

    window.isReducedMotion = () =>
      window.matchMedia(`(prefers-reduced-motion: reduce)`) === true ||
      window.matchMedia(`(prefers-reduced-motion: reduce)`).matches === true;

    window.onload = () => {
      if (!isReducedMotion()) {
        decay();
      }

      document.addEventListener("resize", () => {
        if (!isReducedMotion()) {
          decay();
        }
      });

      document.addEventListener("scroll", () => {
        if (!isReducedMotion()) {
          decay();
        }
      });
    };
  </script>
</html>
