<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="og:title" content="December Adventure 2024 | @unjello" />
    <meta property="twitter:title" content="December Adventure 2024 | @unjello">
    <meta property="og:url" content="http://andrzej.lichnerowicz.pl/en/blog/december-adventure-2024/" />
    <meta property="og:type" content="blog" />
    
    
    
    <meta property="og:description" content="The December Adventure is low key. The goal is to write a little bit of code every day in December." />
    <meta property="twitter:description" content="The December Adventure is low key. The goal is to write a little bit of code every day in December.">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.1.7/purify.min.js" integrity="sha512-BdRNuI8/lsyxkKQVxK1lVtfZshggfXPAwEP+JAOJEKx6Y8SLfcBSRdaWyXQmMxo+wG180uFqXYGjGRL0mh4/Jw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    
    
      <link rel="stylesheet" href="/css/style.min.2e859e4992bcd5ecfc1a48111216f98958cd0696c0278c0e2513e50ee64ead0d.css" integrity="sha256-LoWeSZK81ez8GkgREhb5iVjNBpbAJ4wOJRPlDuZOrQ0=" crossorigin="anonymous">
    
    
    <title>December Adventure 2024 | Blog @unjello</title>
  </head>
  <body>
    <div class="layout container-fluid">
        <header>
            <h1>
                <a href="/">Andrzej unjello Lichnerowicz</a>
            </h1>
            <ul class="list-inline tagline">
                
                    <li class="list-inline-item">he</li>
                
                    <li class="list-inline-item">him</li>
                
                    <li class="list-inline-item">activist</li>
                
                    <li class="list-inline-item">trees and greenery lover</li>
                
            </ul>
            <ul class="list-inline socialmedia">
                
                    <li class="list-inline-item">
                        <a href="https://mastodon.gamedev.place/@unjello">mastodon</a>
                    </li>                            
                
                    <li class="list-inline-item">
                        <a href="https://codeberg.org/unjello">codeberg</a>
                    </li>                            
                
                    <li class="list-inline-item">
                        <a href="mailto:andrzej@lichnerowicz.pl">email</a>
                    </li>                            
                
                    <li class="list-inline-item">
                        <a href="https://andrzej.lichnerowicz.pl/public.pgp">pgp</a>
                    </li>                            
                
            </ul>
        </header>

        <section class="blog_single">
            <h1>December Adventure 2024</h1>
            <div class="date">2024-12-12T21:10:15&#43;02:00</div>
            <div class="content">
                <p>I have stumbled across a <a href="https://mastodon.gamedev.place/@crc@bsd.cafe/113555993612328150">post</a> on mastodon. I never really took part in no trends, but this somehow had the right vibes, or maybe I changed? Dunno. The point is, I feel like I want to do it :)</p>
<p>So inspired by <a href="https://mastodon.gamedev.place/@eli_oat@tenforward.social">@eli_oat</a>, with a whole <a href="https://eli.li/december-adventure">webring</a> going on, without further ado:</p>
<h1 id="day-12">Day 12</h1>
<p>Today I was traveling to Warsaw, for a conference called <a href="https://midi2024.opi.org.pl">12th Machine Intelligence and Digital Interaction</a>. I had one paper accepted for it, but also the organizers were kind enough to invite me for a panel discussion on digital heritage in architecture and arts.</p>
<p><img src="/en/blog/december-adventure-2024/images/IMG_3064.jpg" alt="A photo of the conference&rsquo;s chair announcing a panel discussion. In the background a huge screen with logo of the conference, and panel information"></p>
<p>Met couple cool people,</p>
<p>I have also spent a great time with folks from <a href="https://fhkd.pl">The Foundation for the History of Home Computers </a>. Coming back with at least 2 great ideas. Must. Not. Distract. :)</p>
<p>Train back home was announced to be 15 minutes late, but eventually came after 45. Disaster.</p>
<h1 id="day-11">Day 11</h1>
<p>Not much time today. Renamed <code>Token</code> to <code>Node</code>. I was thinking of naming it <code>Expression</code> but it didn&rsquo;t sit right, as some of the enum variants were in reality just statements&hellip;</p>
<p>I&rsquo;ve also added a simple <code>Node</code> wrapper for <code>Value</code>, that I actually hate, as it looks ugly, and I am going to refactor it soon hopefully. For now it&rsquo;s enough tho:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">pub</span>(<span style="color:#66d9ef">crate</span>) <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">parse_value</span>(input: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">mut</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; <span style="color:#a6e22e">PResult</span><span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    trace(<span style="color:#e6db74">&#34;value&#34;</span>, Value::parse)
</span></span><span style="display:flex;"><span>        .map(<span style="color:#f92672">|</span>v<span style="color:#f92672">|</span> Node::Value(v.unwrap()))
</span></span><span style="display:flex;"><span>        .parse_next(input)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And that should enable working on actual expressions, operators and function calls.</p>
<h1 id="day-10">Day 10</h1>
<p>A little bit more of refactoring. Decided to pull parsing functions into the type for both <code>Value</code> and <code>Token</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> Value {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pub</span>(<span style="color:#66d9ef">crate</span>) <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">parse</span>(input: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">mut</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; <span style="color:#a6e22e">PResult</span><span style="color:#f92672">&lt;</span>Option<span style="color:#f92672">&lt;</span>Self<span style="color:#f92672">&gt;&gt;</span> {
</span></span><span style="display:flex;"><span>        trace(
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;value&#34;</span>,
</span></span><span style="display:flex;"><span>            alt((
</span></span><span style="display:flex;"><span>                Self::parse_float_dot,
</span></span><span style="display:flex;"><span>                Self::parse_uint,
</span></span><span style="display:flex;"><span>                Self::parse_string,
</span></span><span style="display:flex;"><span>                Self::parse_boolean,
</span></span><span style="display:flex;"><span>                Self::parse_undefined,
</span></span><span style="display:flex;"><span>            )),
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        .map(<span style="color:#f92672">|</span>v<span style="color:#f92672">|</span> Ok(v))
</span></span><span style="display:flex;"><span>        .parse_next(input)<span style="color:#f92672">?</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h1 id="day-09">Day 09</h1>
<p>Had to do a little bit of refactoring. I never understood why some Rust library authors prefer to stuff 100k of code straight into <code>lib.rs</code>. It always felt weird, and unsettling. I like my files broken down. So when my interpreter started to approach 500 LOC, I had to split it into several files.</p>
<p>Now that I have proper values, as well as variables that can hold values, I figured I need a trait for things that can be turned into value. In the mean time, I had to look up the syntax for matching structure enums&hellip; that&rsquo;s definietely not overly intuitive, but looks pretty after a while:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> ToValue <span style="color:#66d9ef">for</span> Token {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">to_value</span>(<span style="color:#f92672">&amp;</span>self) -&gt; <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">Value</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">match</span> self {
</span></span><span style="display:flex;"><span>            Token::Variable {
</span></span><span style="display:flex;"><span>                value: Some(<span style="color:#66d9ef">ref</span> v), <span style="color:#f92672">..</span>
</span></span><span style="display:flex;"><span>            } <span style="color:#f92672">=&gt;</span> v,
</span></span><span style="display:flex;"><span>            _ <span style="color:#f92672">=&gt;</span> unreachable!(),
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="day-08">Day 08</h1>
<p>A day of string interpolation. In the meantime, I&rsquo;ve learned that Rust does not understand <code>\g</code>. But maybe that&rsquo;s for the better&hellip; who&rsquo;d use that in 2024 anyway?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">test_string_interpolate</span>() {
</span></span><span style="display:flex;"><span>    assert_eq!(interpolate_from(<span style="color:#e6db74">&#34;:)&#34;</span>), <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>.to_string());
</span></span><span style="display:flex;"><span>    assert_eq!(interpolate_from(<span style="color:#e6db74">&#34;:):&gt;&#34;</span>), <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n\t</span><span style="color:#e6db74">&#34;</span>.to_string());
</span></span><span style="display:flex;"><span>    assert_eq!(interpolate_from(<span style="color:#e6db74">&#34;:o&#34;</span>), <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x07</span><span style="color:#e6db74">&#34;</span>.to_string());
</span></span><span style="display:flex;"><span>    assert_eq!(interpolate_from(<span style="color:#e6db74">&#34;:</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span>), <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span>.to_string());
</span></span><span style="display:flex;"><span>    assert_eq!(interpolate_from(<span style="color:#e6db74">&#34;::&#34;</span>), <span style="color:#e6db74">&#34;:&#34;</span>.to_string());
</span></span><span style="display:flex;"><span>    assert_eq!(interpolate_from(<span style="color:#e6db74">&#34;:(70)&#34;</span>), <span style="color:#e6db74">&#34;p&#34;</span>.to_string());
</span></span><span style="display:flex;"><span>    assert_eq!(interpolate_from(<span style="color:#e6db74">&#34;:(70):(6F)&#34;</span>), <span style="color:#e6db74">&#34;po&#34;</span>.to_string());
</span></span><span style="display:flex;"><span>    assert_eq!(
</span></span><span style="display:flex;"><span>        interpolate_from(<span style="color:#e6db74">&#34;:[black star]:[snowman]:[black star]&#34;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;★☃★&#34;</span>.to_string()
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    assert_eq!(
</span></span><span style="display:flex;"><span>        interpolate_from(<span style="color:#e6db74">&#34;:):(70):::&gt;:[black star]:(6F):[snowman]::&#34;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">p:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">★o☃:&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span></code></pre></div><h1 id="day-07">Day 07</h1>
<p>A little context switch again. Riddle for <a href="https://adventofcode.com/2024/day/4">day four</a> of advent code bothered me for some time now. It was easy to solve it in imperative way, but I really wanted to solve it in racket in a way that will be generic for both parts.</p>
<p>So first we define the patterns. I wanted to describe both searches in a purely declarative manner:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> part-1-pattern <span style="color:#f92672">&#39;</span>((<span style="color:#e6db74">#\X</span> <span style="color:#e6db74">&#34;XMAS&#34;</span>
</span></span><span style="display:flex;"><span>        (((<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">3</span>))
</span></span><span style="display:flex;"><span>         ((<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>         ((<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">2</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span>))
</span></span><span style="display:flex;"><span>         ((<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">-1</span>) (<span style="color:#ae81ff">2</span> <span style="color:#ae81ff">-2</span>) (<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">-3</span>))
</span></span><span style="display:flex;"><span>         ((<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">-1</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">-2</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">-3</span>))
</span></span><span style="display:flex;"><span>         ((<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">-2</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">-3</span> <span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>         ((<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">-1</span>) (<span style="color:#ae81ff">-2</span> <span style="color:#ae81ff">-2</span>) (<span style="color:#ae81ff">-3</span> <span style="color:#ae81ff">-3</span>))
</span></span><span style="display:flex;"><span>         ((<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">-2</span> <span style="color:#ae81ff">2</span>) (<span style="color:#ae81ff">-3</span> <span style="color:#ae81ff">3</span>))))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> part-2-pattern <span style="color:#f92672">&#39;</span>(
</span></span><span style="display:flex;"><span>  (<span style="color:#e6db74">#\A</span> <span style="color:#e6db74">&#34;MASMAS&#34;</span> (((<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">-1</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">-1</span>))))
</span></span><span style="display:flex;"><span>  (<span style="color:#e6db74">#\A</span> <span style="color:#e6db74">&#34;MASSAM&#34;</span> (((<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">-1</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">-1</span>))))
</span></span><span style="display:flex;"><span>  (<span style="color:#e6db74">#\A</span> <span style="color:#e6db74">&#34;SAMMAS&#34;</span> (((<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">-1</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">1</span>) (<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>) (<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">-1</span>))))))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Then some helpers, to get the size of the grid&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (grid-size grid)
</span></span><span style="display:flex;"><span>  (list (string-length (car grid)) (length grid)))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>&hellip; to check if coordinates are valid&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (coord-valid? xy height width)
</span></span><span style="display:flex;"><span>  (not (<span style="color:#66d9ef">or</span> (&lt; (car xy) <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>           (&gt;= (car xy) width)
</span></span><span style="display:flex;"><span>           (&lt; (cadr xy) <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>           (&gt;= (cadr xy) height))))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>&hellip; and finally to get a character under at the coords, or <code>false</code> if coords are out of bounds.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (coord-get grid xy width height)
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">if</span> (coord-valid? xy width height)
</span></span><span style="display:flex;"><span>      (string-ref (list-ref grid (car xy)) (cadr xy))
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">#f</span>))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Next, I loop through the patterns. For every pattern I try to get the characters under the coords. I further process only the strings that are fully fetched &ndash; i.e. they have as many characters as coords in the pattern &ndash; and I return the list with the strings for each pattern matched.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (patterns-&gt;characters grid xy width height patterns)
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">let*</span> ([valid? <span style="color:#66d9ef">#t</span>]
</span></span><span style="display:flex;"><span>         [result <span style="color:#f92672">&#39;</span>()]
</span></span><span style="display:flex;"><span>         [bind-coord-get (<span style="color:#66d9ef">lambda</span> (bind-xy)
</span></span><span style="display:flex;"><span>                           (coord-get grid
</span></span><span style="display:flex;"><span>                                      (list (+ (car xy) (car bind-xy))
</span></span><span style="display:flex;"><span>                                            (+ (cadr xy) (cadr bind-xy)))
</span></span><span style="display:flex;"><span>                                      width
</span></span><span style="display:flex;"><span>                                      height))])
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">define</span> (pattern-&gt;characters pattern)
</span></span><span style="display:flex;"><span>      (<span style="color:#66d9ef">let*</span> ([result (filter-map bind-coord-get pattern)]
</span></span><span style="display:flex;"><span>             [pattern-len (length pattern)]
</span></span><span style="display:flex;"><span>             [result-len (length result)])
</span></span><span style="display:flex;"><span>        (<span style="color:#66d9ef">if</span> (equal? pattern-len result-len) result <span style="color:#66d9ef">#f</span>)))
</span></span><span style="display:flex;"><span>    (map list-&gt;string (filter-map pattern-&gt;characters patterns))))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>And here&rsquo;s the main loop. Going through the grid, I look for the character defined in the pattern. If I find one, I get all the strings defined by the pattern coords. Then I sum how many of those strings I&rsquo;ve found actually matched a given pattern.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (solve-pattern grid pattern)
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">let*</span> ([result <span style="color:#f92672">&#39;</span>()]
</span></span><span style="display:flex;"><span>         [debug-result <span style="color:#f92672">&#39;</span>()]
</span></span><span style="display:flex;"><span>         [size (grid-size grid)]
</span></span><span style="display:flex;"><span>         [width (car size)]
</span></span><span style="display:flex;"><span>         [height (cadr size)]
</span></span><span style="display:flex;"><span>         [search-char (car pattern)]
</span></span><span style="display:flex;"><span>         [search-string (cadr pattern)]
</span></span><span style="display:flex;"><span>         [search-pattern (caddr pattern)]
</span></span><span style="display:flex;"><span>         [is-search-string?
</span></span><span style="display:flex;"><span>          (<span style="color:#66d9ef">lambda</span> (x)
</span></span><span style="display:flex;"><span>            (<span style="color:#66d9ef">or</span> (equal? x search-string)
</span></span><span style="display:flex;"><span>                (equal? (list-&gt;string (reverse (string-&gt;list x)))
</span></span><span style="display:flex;"><span>                        search-string)))])
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">for*</span> ([x (in-range height)]
</span></span><span style="display:flex;"><span>           [y (in-range width)])
</span></span><span style="display:flex;"><span>      (<span style="color:#66d9ef">when</span> (char=? search-char (coord-get grid (list x y) width height))
</span></span><span style="display:flex;"><span>        (<span style="color:#66d9ef">set!</span>
</span></span><span style="display:flex;"><span>         result
</span></span><span style="display:flex;"><span>         (cons (length (filter identity
</span></span><span style="display:flex;"><span>                               (map is-search-string?
</span></span><span style="display:flex;"><span>                                    (patterns-&gt;characters grid
</span></span><span style="display:flex;"><span>                                                          (list x y)
</span></span><span style="display:flex;"><span>                                                          width
</span></span><span style="display:flex;"><span>                                                          height
</span></span><span style="display:flex;"><span>                                                          search-pattern))))
</span></span><span style="display:flex;"><span>               result))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    (apply + result)))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>Finally I sum all the sums, to get the final hit number. In the begining, this was only one loop. The core function was the one above, but I didn&rsquo;t find a feasable way to get Part 2 working with one <em>search string</em>. That&rsquo;s why eventually the pattern became a list of patterns.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (solve grid patterns)
</span></span><span style="display:flex;"><span>  (apply + (map (<span style="color:#66d9ef">lambda</span> (x) (solve-pattern grid x)) patterns)))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>And the formalities, print out the answers.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (main)
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">let*</span> ([input (port-&gt;string (open-input-file <span style="color:#e6db74">&#34;day04.txt&#34;</span>) <span style="color:#66d9ef">#:close?</span> <span style="color:#66d9ef">#t</span>)]
</span></span><span style="display:flex;"><span>         [grid (string-split input <span style="color:#e6db74">#px&#34;\n&#34;</span>)])
</span></span><span style="display:flex;"><span>    (printf <span style="color:#e6db74">&#34;Total XMAS: ~a</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> (solve grid part-1-pattern))
</span></span><span style="display:flex;"><span>    (printf <span style="color:#e6db74">&#34;Total X-MAS: ~a</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> (solve grid part-2-pattern))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(main)<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>It ain&rsquo;t pretty. Functional mindset was a long dream of mine, but it is apparent that it is hard for me to unlearn imperative ways.</p>
<h1 id="day-06">Day 06</h1>
<p>Not much time today either. Work, Xmas Party afterhours, and setting up cookies and milk for Santa with the kids, but also a trap to catch him in the act :)</p>
<p>Still I managed to add parsing for following sections of 1.2 spec:</p>
<ul>
<li>File Creation</li>
<li>Comments</li>
<li>Variables</li>
</ul>
<p>More updates tomorrow.</p>
<h1 id="day-05">Day 05</h1>
<p>Today was a busy day, couldn&rsquo;t spend too much time off work. But did manage to think through, or at least to take a stab at the last missing piece I think I need, which is:</p>
<h2 id="file-io">File I/O</h2>
<ol>
<li>Open a file</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">I</span> <span style="color:#a6e22e">HAS</span> <span style="color:#a6e22e">A</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">file_handle</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">ITZ</span> <span style="color:#a6e22e">SHIP</span> <span style="color:#e6db74">&#34;&lt;filename&gt;&#34;</span> <span style="color:#a6e22e">WIF</span> <span style="color:#e6db74">&#34;&lt;mode&gt;&#34;</span>
</span></span></code></pre></div><p>Mode can be:</p>
<ul>
<li><code>SNAGGING</code>: read mode</li>
<li><code>SLAPIN</code>: write mode, truncates file</li>
<li><code>ADDIN</code>: append mode</li>
</ul>
<p>all file input/output is done assuming text-mode. No support for binary yet.</p>
<ol start="2">
<li>Read from a file</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">SLURP</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">variable</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">OFFA</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">file_handle</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><ol start="3">
<li>Write to a file</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">SCOOP</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">data</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">IN2</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">file_handle</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><p>The command <code>VISIBLE &lt;data&gt;</code> is a backwards compatible equivalent of <code>SCOOP &lt;data&gt; IN2 MAHOUT</code>.</p>
<ol start="4">
<li>Close the file</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">UNSHIP</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">file_handle</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><ol start="5">
<li>Predefined file handles</li>
</ol>
<p>As in many systems, LULZ comes with predefined handles for standard streams;</p>
<ul>
<li>stdio is <code>MAHIN</code></li>
<li>stdout is <code>MAHOUT</code></li>
<li>stderr is <code>MAHBAD</code></li>
</ul>
<p>you can use them in place of <code>file_handle</code></p>
<h1 id="day-04">Day 04</h1>
<p>Oh dear attention deficit&hellip; today isn&rsquo;t my day with Scheme. To be honest, it&rsquo;s one of those days where everything I touch turns to sh*t. So, I needed something fun. The chain of events that led me here is completely random, but in the end, I stumbled upon LOLCODE! It’s so appealing, in a very weird way, and still&hellip;</p>
<p>The only problem with this language is its age &ndash; it&rsquo;s almost 15 years old. That nearly qualifies as retro; there are things in museums that are just as old. The issue isn&rsquo;t necessarily its age but the fact that the authors never fully standardized certain aspects of it. What I really need are arrays and file input/output capabilities. So here&rsquo;s my attempt at the spec, and interpreter might follow soon ;)</p>
<h2 id="arrays">Arrays</h2>
<ol>
<li>Empty array declaration</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">I</span> <span style="color:#a6e22e">HAS</span> <span style="color:#a6e22e">A</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">array_name</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">ITZ</span> <span style="color:#a6e22e">A</span> <span style="color:#a6e22e">BUKKIT</span>
</span></span></code></pre></div><ol start="2">
<li>Array with initial values</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">I</span> <span style="color:#a6e22e">HAS</span> <span style="color:#a6e22e">A</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">array_name</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">ITZ</span> <span style="color:#a6e22e">A</span> <span style="color:#a6e22e">BUKKIT</span> <span style="color:#a6e22e">WIF</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">value1</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">AN</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">value2</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">AN</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">value3</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">MKAY</span>
</span></span></code></pre></div><ol start="3">
<li>Is array empty?</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">IZ</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">array_name</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">GHOST</span><span style="color:#960050;background-color:#1e0010">?</span>
</span></span></code></pre></div><ol start="4">
<li>Getting array size</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">HOW</span> <span style="color:#a6e22e">BIG</span> <span style="color:#a6e22e">IZ</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">array_name</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><ol start="5">
<li>Retrieving an item from array</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">I</span> <span style="color:#a6e22e">HAS</span> <span style="color:#a6e22e">A</span> <span style="color:#a6e22e">ma_value</span> <span style="color:#a6e22e">ITZ</span> <span style="color:#a6e22e">ma_numbers</span> <span style="color:#a6e22e">LOK</span> <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><ol start="6">
<li>Appending value at the end of array</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">YEET</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">value</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">LOK</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">array_name</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><ol start="7">
<li>Updating value at the index</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">YEET</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">value</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">INDA</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">array_name</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">LOK</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">index</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><ol start="8">
<li>Removing element at index</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">BAI</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">array_name</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">LOK</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">index</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><ol start="9">
<li>
<p>Iterating over array</p>
<p>A label in the <code>IM IN YR &lt;label&gt;</code> for-loop defined in <a href="https://github.com/justinmeza/lolcode-spec/blob/master/v1.2/lolcode-spec-v1.2.md">1.2 version of the spec</a> is not used, and I was tempted to re-use it, but at the end of the day, I think a dedicated loop fits here:</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-awk" data-lang="awk"><span style="display:flex;"><span><span style="color:#a6e22e">FORE4CH</span> <span style="color:#a6e22e">YR</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">item_variable</span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">IN</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">array_name</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">statements</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">KTH</span>
</span></span></code></pre></div><p>And that&rsquo;s it for now. In the mean time I am working on implementing basics of 1.2 spec using <a href="https://docs.rs/winnow/latest/winnow/">winnow</a> and Rust:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">parse_program_begin</span>(input: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">mut</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; Result {
</span></span><span style="display:flex;"><span>    seq!(Token::Hai{
</span></span><span style="display:flex;"><span>        _: <span style="color:#e6db74">&#34;HAI&#34;</span>,
</span></span><span style="display:flex;"><span>        _: <span style="color:#a6e22e">space1</span>,
</span></span><span style="display:flex;"><span>        major: <span style="color:#a6e22e">dec_uint</span>,
</span></span><span style="display:flex;"><span>        _: <span style="color:#e6db74">&#34;.&#34;</span>,
</span></span><span style="display:flex;"><span>        minor: <span style="color:#a6e22e">dec_uint</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    .parse_next(input)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">parse_program_end</span>(input: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">mut</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; Result {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;KTHXBAI&#34;</span>.map(<span style="color:#f92672">|</span>_<span style="color:#f92672">|</span> Ok(Token::Kthxbai)).parse_next(input)<span style="color:#f92672">?</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="day-03">Day 03</h1>
<p>Slowly everything starts coming together. The ports turned out to be quite simple, and intuitive. They&rsquo;re just a <code>HANDLE</code>, an abstraction of input used by other read/write functions. The lexer is not bad either, follows similar pattern to <code>cond</code> or <code>match-string</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(define-lex-abbrev CRLF (seq <span style="color:#e6db74">#\return</span> <span style="color:#e6db74">#\newline</span>))
</span></span><span style="display:flex;"><span>(define-lex-abbrev NEWLINE (<span style="color:#66d9ef">or</span> CRLF <span style="color:#e6db74">#\return</span> <span style="color:#e6db74">#\newline</span>))
</span></span><span style="display:flex;"><span>(define-lex-abbrev BACKSLASH-NEWLINE (seq <span style="color:#e6db74">#\\</span> NEWLINE))
</span></span><span style="display:flex;"><span>(define-lex-abbrev ANY-NEWLINE (<span style="color:#66d9ef">or</span> BACKSLASH-NEWLINE NEWLINE))
</span></span><span style="display:flex;"><span>(define-lex-abbrev ANY-CHAR (char-complement (union)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> lex 
</span></span><span style="display:flex;"><span>  (lexer 
</span></span><span style="display:flex;"><span>    [(eof) <span style="color:#f92672">&#39;</span><span style="color:#e6db74">EOF</span>] 
</span></span><span style="display:flex;"><span>    [ANY-NEWLINE (lex input-port)] 
</span></span><span style="display:flex;"><span>    [ANY-CHAR (display lexeme)]))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (run-lexer port) 
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">when</span> (not (eq? <span style="color:#f92672">&#39;</span><span style="color:#e6db74">eof</span> (lex port))) (run-lexer port)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (main)
</span></span><span style="display:flex;"><span>  (run-lexer (open-input-string <span style="color:#e6db74">&#34;_</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">FI</span><span style="color:#ae81ff">\\\n</span><span style="color:#e6db74">LE</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">__&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">module+</span> main
</span></span><span style="display:flex;"><span>  (main))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>now that I have this out of the way, I am going to do something I haven&rsquo;t done in a long time - I am going to use the <a href="https://gcc.gnu.org/onlinedocs/cpp/">manual</a> and implement the preprocessor according to the rules :)</p>
<h1 id="day-02">Day 02</h1>
<p>Not much time today, so didn&rsquo;t really managed to write any code towards the preprocessor. I was also still having a kind of inner battle between heart (Scheme) and reason (Rust). Not sure if that&rsquo;s a victory, but heart still wins :)</p>
<p>I&rsquo;ve never really studied parsers. I think I am aware enough to appreciate the complexities and subtlety that goes into them, but throughout my career I only did very naive handmade parsers, then used <a href="https://www.boost.org/doc/libs/1_85_0/libs/spirit/doc/html/index.html">Spirit</a> quite a lot &ndash; and frankly loved it! &ndash; and then used some Parser Expression Grammars like <a href="https://docs.rs/nom/latest/nom/">nom</a> or <a href="https://docs.rs/winnow/latest/winnow/">winnow</a>. I must admit tho, that I find PEGs a little confusing&hellip; the first-match wins rule never won my heart. I think in backtracking terms&hellip;</p>
<p>Also, since I really only picked up Scheme like 2-3 days ago, every piece of documentation I read, opens another doors to yet another new concept. Like I tried to delay learning <code>input-ports</code> and kept operating on strings as long as I could, but with lexer it was inevitable. So here I am, going down a rabbit hole&hellip; :)</p>
<h1 id="day-01">Day 01</h1>
<p>I have few projects in my head, I was trying to <del>finish</del>, who am I kidding, I was trying to even start them, for a long, long time. I am not going to write about the end goal yet, as I am not sure how long I am going to last, but for now, I want to focus on writing a C preprocessor. But also, I really wanna write it in Scheme. Or maybe I should rather say Racket. And to start well, here&rsquo;s a little <a href="https://adventofcode.com">Advent of Code</a> I did, my first Scheme in &ldquo;production&rdquo;:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (parse-input lines)
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">for/fold</span> ([left-list <span style="color:#f92672">&#39;</span>()]
</span></span><span style="display:flex;"><span>             [right-list <span style="color:#f92672">&#39;</span>()])
</span></span><span style="display:flex;"><span>            ([line lines])
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">let*</span> ([parts (map string-&gt;number (regexp-split <span style="color:#e6db74">#px&#34;\\s+&#34;</span> line))]
</span></span><span style="display:flex;"><span>           [left (first parts)]
</span></span><span style="display:flex;"><span>           [right (second parts)])
</span></span><span style="display:flex;"><span>      (values (cons left left-list) (cons right right-list)))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (read-input filename)
</span></span><span style="display:flex;"><span>  (parse-input (file-&gt;lines filename)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (calculate-total-distance left right)
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">letrec</span> ([calculate (<span style="color:#66d9ef">lambda</span> (l r a)
</span></span><span style="display:flex;"><span>                        (<span style="color:#66d9ef">cond</span>
</span></span><span style="display:flex;"><span>                          [(<span style="color:#66d9ef">or</span> (empty? l) (empty? r)) a]
</span></span><span style="display:flex;"><span>                          [<span style="color:#66d9ef">else</span> (calculate (rest l) (rest r) (+ a (abs (- (first l) (first r)))))]))])
</span></span><span style="display:flex;"><span>    (calculate (sort left &lt;) (sort right &lt;) <span style="color:#ae81ff">0</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">define</span> (calculate-similarity-score left right)
</span></span><span style="display:flex;"><span>  (<span style="color:#66d9ef">let</span> ([frequency-map (make-hash)])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">for</span> ([num right])
</span></span><span style="display:flex;"><span>      (hash-set! frequency-map num (+ (hash-ref frequency-map num <span style="color:#ae81ff">0</span>) <span style="color:#ae81ff">1</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    (<span style="color:#66d9ef">for/fold</span> ([acc <span style="color:#ae81ff">0</span>]) ([num left])
</span></span><span style="display:flex;"><span>      (+ acc (* num (hash-ref frequency-map num <span style="color:#ae81ff">0</span>))))))<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>I already know it might be better, and I&rsquo;ll polish it tomorrow. It&rsquo;s kinda getting late, and I wanted to get this post out. G&rsquo;nite :)</p>


                
                <div class="comments">
                    <h2>Comments</h2>
                    <p>Discussion powered by <i class="fa-brands fa-mastodon"></i>, <a href="https://mastodon.gamedev.place/@unjello/113580023530866158">hop in.</a> if you want.</p>
                    <div id="comments"></div>
                </div>
            <script>
    (async function() {
        const commentsDiv = document.getElementById('comments');
        const statusId = '113580023530866158';
        const mastodonInstance = 'mastodon.gamedev.place';
        const contextUrl = `https://${mastodonInstance}/api/v1/statuses/${statusId}/context`;

        try {
            const response = await fetch(contextUrl);

            if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
            }

            const context = await response.json();
            const comments = context.descendants;
            comments.forEach(comment => {
                const commentElement = document.createElement('div');
                commentElement.classList.add('comment');

                const authorName = DOMPurify.sanitize(comment.account.display_name || comment.account.username);
                const authorUrl = DOMPurify.sanitize(comment.account.url);
                const content = DOMPurify.sanitize(comment.content);
                const avatarUrl = DOMPurify.sanitize(comment.account.avatar_static || comment.account.avatar);
                const createdAt = new Date(comment.created_at);
                const timestamp = createdAt.toLocaleString();

                const avatarImg = document.createElement('img');
                avatarImg.src = avatarUrl;
                avatarImg.alt = `${authorName}'s avatar`;
                avatarImg.classList.add('avatar');

                const contentDiv = document.createElement('div');
                contentDiv.classList.add('comment-content');

                const headerDiv = document.createElement('div');
                headerDiv.classList.add('comment-header');

                const authorLink = document.createElement('a');
                authorLink.href = authorUrl;
                authorLink.target = '_blank';
                authorLink.textContent = authorName;

                const timeSpan = document.createElement('span');
                timeSpan.classList.add('timestamp');
                timeSpan.textContent = `• ${timestamp}`;

                headerDiv.appendChild(authorLink);
                headerDiv.appendChild(timeSpan);

                const bodyDiv = document.createElement('div');
                bodyDiv.classList.add('comment-body');
                bodyDiv.innerHTML = content;

                contentDiv.appendChild(headerDiv);
                contentDiv.appendChild(bodyDiv);

                commentElement.appendChild(avatarImg);
                commentElement.appendChild(contentDiv);

                commentsDiv.appendChild(commentElement);            });


        } catch (error) {
            console.error('Error fetching comments:', error);
            commentsDiv.innerHTML = '<p>Error loading comments.</p>';
        }
    })();

            </script>
                
            </div>
        </section>
        <script>
              
                        (function addTitleToCodeBlock() {
  let list = document.body.getElementsByClassName("highlight");

  for (i = 0; i <= list.length - 1; i++) {
    let code = list[i].firstElementChild.firstElementChild;
    let codeName = code ? code.className.split(":")[1] : null;

    if (codeName) {
                console.log(codeName)
      let div = document.createElement("div");
      div.textContent = codeName;
      div.classList.add("code-name");
      code.parentNode.insertBefore(div, code);
    }
  }
})();

        </script>

        <footer class="fs-6 text-muted mt-5">
            <p>
                CC0. Powered by <a href="https://gohugo.io">Hugo</a>. Theme inspired by <a href="https://www.mattdesl.com/">@mattdesl</a> and <a href="https://ozafoto.com/digital/">Oza</a>.
            </p>
        </footer>
    </div>
  </body>
</html>
