1:"$Sreact.fragment"
2:I[1544,["177","static/chunks/app/layout-7ea7f0006323b5b6.js"],"AsciiArtLogger"]
3:I[2738,["177","static/chunks/app/layout-7ea7f0006323b5b6.js"],"ThemeProvider"]
4:I[7555,[],""]
5:I[1295,[],""]
6:I[9543,["345","static/chunks/app/not-found-374964195ecf67e5.js"],"default"]
8:I[9665,[],"MetadataBoundary"]
a:I[9665,[],"OutletBoundary"]
d:I[4911,[],"AsyncMetadataOutlet"]
f:I[9665,[],"ViewportBoundary"]
11:I[6614,[],""]
:HL["/_next/static/css/e5565d963fd839c1.css","style"]
:HL["/_next/static/css/72f0b751ba818b6f.css","style"]
0:{"P":null,"b":"vI1f1rc00foWP8-o_ZTsc","p":"","c":["","en","blog","2024","notebook-multiprocessing",""],"i":false,"f":[[["",{"children":["en",{"children":["blog",{"children":[["slug","2024/notebook-multiprocessing","oc"],{"children":["__PAGE__",{}]}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/e5565d963fd839c1.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","suppressHydrationWarning":true,"children":[["$","head",null,{"children":[["$","link",null,{"rel":"icon","href":"/favicon.ico","sizes":"any"}],["$","link",null,{"rel":"apple-touch-icon","href":"/apple-touch-icon.png"}]]}],["$","body",null,{"children":[["$","$L2",null,{}],["$","$L3",null,{"children":["$","$L4",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","$L6",null,{}],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]]}]]}]]}],{"children":["en",["$","$1","c",{"children":[null,["$","$L4",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["blog",["$","$1","c",{"children":[null,["$","$L4",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["slug","2024/notebook-multiprocessing","oc"],["$","$1","c",{"children":[null,["$","$L4",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L7",["$","$L8",null,{"children":"$L9"}],[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/72f0b751ba818b6f.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","$La",null,{"children":["$Lb","$Lc",["$","$Ld",null,{"promise":"$@e"}]]}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","YbZG_O45J5TCQ--3MUDw9",{"children":[["$","$Lf",null,{"children":"$L10"}],null]}],null]}],false]],"m":"$undefined","G":["$11","$undefined"],"s":false,"S":true}
12:"$Sreact.suspense"
13:I[4911,[],"AsyncMetadata"]
9:["$","$12",null,{"fallback":null,"children":["$","$L13",null,{"promise":"$@14"}]}]
c:null
10:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
b:null
14:{"metadata":[["$","title","0",{"children":"Multiprocessing in Jupyter Notebooks | @unjello blog"}],["$","meta","1",{"property":"og:title","content":"Multiprocessing in Jupyter Notebooks | @unjello blog"}],["$","meta","2",{"property":"og:url","content":"https://andrzej.lichnerowicz.pl/en/blog/2024/notebook-multiprocessing/"}],["$","meta","3",{"property":"og:image","content":"https://andrzej.lichnerowicz.pl/images/2024/notebook_multiprocessing/index/96dz0h.jpg"}],["$","meta","4",{"property":"og:image:width","content":"1200"}],["$","meta","5",{"property":"og:image:height","content":"630"}],["$","meta","6",{"property":"og:image:alt","content":"Multiprocessing in Jupyter Notebooks | @unjello blog"}],["$","meta","7",{"property":"og:type","content":"article"}],["$","meta","8",{"property":"article:published_time","content":"2024-10-13T20:01:33+02:00"}],["$","meta","9",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","10",{"name":"twitter:title","content":"Multiprocessing in Jupyter Notebooks | @unjello blog"}],["$","meta","11",{"name":"twitter:image","content":"https://andrzej.lichnerowicz.pl/images/2024/notebook_multiprocessing/index/96dz0h.jpg"}],["$","link","12",{"rel":"shortcut icon","href":"/favicon.ico"}],["$","link","13",{"rel":"icon","href":"/favicon.ico","sizes":"any"}],["$","link","14",{"rel":"apple-touch-icon","href":"/apple-touch-icon.png"}]],"error":null,"digest":"$undefined"}
e:{"metadata":"$14:metadata","error":null,"digest":"$undefined"}
15:I[8109,["72","static/chunks/72-d3fcf2c32f7e11b9.js","435","static/chunks/435-711aececbe1f0279.js","447","static/chunks/app/en/blog/%5B%5B...slug%5D%5D/page-6c4a572667fc6dca.js"],"ThemeSwitcher"]
17:I[6874,["72","static/chunks/72-d3fcf2c32f7e11b9.js","435","static/chunks/435-711aececbe1f0279.js","447","static/chunks/app/en/blog/%5B%5B...slug%5D%5D/page-6c4a572667fc6dca.js"],""]
18:I[1809,["72","static/chunks/72-d3fcf2c32f7e11b9.js","435","static/chunks/435-711aececbe1f0279.js","447","static/chunks/app/en/blog/%5B%5B...slug%5D%5D/page-6c4a572667fc6dca.js"],"AsciiBorderedMdx"]
16:T545,                              _______._ _
                      _ _.___/       |
                         |           |
                         |           |
             -----+-----                          ___     ___
                  |              ______   ___    /  /____    \
            __________ _-+-_____/ .(  .\_(xhb)__|  |(     \   |
           /.   |..   \..  ___/.\ . ) ..\ . ____\  |  o  / |  |
          |..    ).    |.  \    .|.(  ...|.(.   :  (____|  |  |
         (______/..    |.   \___.|______ . ______|..       | 9|
          )..          |.      |    ..   |..     \ .       | 9[
         ( .    o      |.      |     .\  |.       |. ___/ (|  ]
          \___________/..      |\_______/________/\_________\ [
               |_______________|  ____________________________]
                         :           |
    - -----andrzej-_ ____\_____|----_|_____________'-lichnerowicz-------- -
                         :           |
 .     p e r s o n a l ! |    #1     | wEBPAGE                            .
 . _         - --------- |  - -- -   | ------- -                         _  .
-:-\-\-------------------|- -     - -|-----------------------------------\-\-:
 |                      _|___________|_                                      |
 |                       :           :                                       |7:["$","div",null,{"className":"flex justify-center","children":["$","div",null,{"className":"ascii-art nfo-pre","children":[["$","$L15",null,{}],["$","div",null,{"className":"header-component","children":"$16"}]," |//_)-> 2 0 2 4 . 1 0 . 1 3 <--------------------------------------------(_\\|\n",[["$","div",null,{"className":"whitespace-pre font-mono","children":" |                                                                           |"}],["$","div",null,{"className":"whitespace-pre font-mono","children":" |                                                                           |"}],["$","div",null,{"className":"whitespace-pre font-mono","style":{"display":"flex"},"children":[" | ",["$","$L17",null,{"href":"/","className":"hover:underline inline-block","prefetch":false,"style":{"textDecoration":"none","color":"inherit","width":"calc(100% - 6ch)"},"children":"<< back                                                                     "}],"|"]}],["$","div",null,{"className":"whitespace-pre font-mono","children":" |                                                                           |"}]],["$","$L18",null,{"children":[["$","div",null,{"style":{"fontWeight":"bold","fontSize":"1.2em","marginTop":"1em","marginBottom":"2.5em"},"children":["# ","Multiprocessing in Jupyter Notebooks"]}],"$L19"]}],"$7:props:children:props:children:3",["$","div",null,{"children":[" \\__                      --> ",["$","a",null,{"href":"http://andrzej.lichnerowicz.pl","target":"_blank","rel":"noopener noreferrer","title":"andrzej.lichnerowicz.pl","className":"link","style":{"cursor":"pointer"},"children":"andrzej.lichnerowicz.pl"}]," <--                  __/\n   //                                                                      \\\\\n  // ------------------------                        ---------------------- \\\\\n '~~~~~~~~~~~~~~~~~~~~~~~~~// ------         ------- \\~~~~~~~~~~~~~~~~~~~~~~`\n                          '~~~~~~~//          \\~~~~~~~`\n                                 // ---------- \\\n                                '~~~~~~~~~~~~~~~`\n      "]}]]}]}]
1b:I[316,["72","static/chunks/72-d3fcf2c32f7e11b9.js","435","static/chunks/435-711aececbe1f0279.js","447","static/chunks/app/en/blog/%5B%5B...slug%5D%5D/page-6c4a572667fc6dca.js"],"Figure"]
20:I[877,["72","static/chunks/72-d3fcf2c32f7e11b9.js","435","static/chunks/435-711aececbe1f0279.js","447","static/chunks/app/en/blog/%5B%5B...slug%5D%5D/page-6c4a572667fc6dca.js"],"Admonition"]
19:[["$","div",null,{"className":"MarkdownHeading_markdown-heading__G6B4T","children":[["$","span",null,{"className":"MarkdownHeading_markdown-hash__CheR_","children":["##"," "]}],["$","span",null,{"children":"TL;DR"}]]}],"\n",["$","p",null,{"children":"To run heavy workloads in a Jupyter Notebook, you need to take your function and store it in a temporary Python source file so it's importable as a module:"}],"\n",["","$L1a"],"\n",["$","p",null,{"children":"Here's what's happening in this code:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"The wrap_fn context manager takes your function fn."}],"\n",["$","li",null,{"children":"It gets the source code of fn and writes it to a temporary Python file."}],"\n",["$","li",null,{"children":"It then imports this temporary file as a module, making your function accessible via a module name."}],"\n",["$","li",null,{"children":"Inside the context, fn is now the function from the temporary module and can be pickled and sent to child processes."}],"\n",["$","li",null,{"children":["We use ",null," to distribute the workload across multiple processes."]}],"\n"]}],"\n",["$","p",null,{"children":"By doing this, we avoid the issue of the function not being picklable due to being defined in the interactive namespace."}],"\n",["$","div",null,{"className":"MarkdownHeading_markdown-heading__G6B4T","children":[["$","span",null,{"className":"MarkdownHeading_markdown-hash__CheR_","children":["##"," "]}],["$","span",null,{"children":"But if you ask me on a deeper level..."}]]}],"\n",["$","p",null,{"children":["Jupyter Notebooks offer a great way to work with many things, combining the ability to play around with data like in a REPL with the maintainability of a script. Once in a while, though, you face a problem that requires some serious raw power. For me, such a moment occurred when I was working on a data matching problem in a dataset containing almost ",["$","span",null,{"className":"katex","children":[["$","span",null,{"className":"katex-mathml","children":["$","math",null,{"xmlns":"http://www.w3.org/1998/Math/MathML","children":["$","semantics",null,{"children":[["$","mrow",null,{"children":[["$","mn",null,{"children":"900"}],["$","mo",null,{"separator":"true","children":","}],["$","mn",null,{"children":"000"}]]}],["$","annotation",null,{"encoding":"application/x-tex","children":"900,000"}]]}]}]}],["$","span",null,{"className":"katex-html","aria-hidden":"true","children":["$","span",null,{"className":"base","children":[["$","span",null,{"className":"strut","style":{"height":"0.8389em","verticalAlign":"-0.1944em"}}],["$","span",null,{"className":"mord","children":"900"}],["$","span",null,{"className":"mpunct","children":","}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.1667em"}}],["$","span",null,{"className":"mord","children":"000"}]]}]}]]}]," elements. Performing naive ",["$","span",null,{"className":"katex","children":[["$","span",null,{"className":"katex-mathml","children":["$","math",null,{"xmlns":"http://www.w3.org/1998/Math/MathML","children":["$","semantics",null,{"children":[["$","mrow",null,{"children":[["$","mi",null,{"children":"A"}],["$","mo",null,{"children":"×"}],["$","mi",null,{"children":"B"}]]}],["$","annotation",null,{"encoding":"application/x-tex","children":"A \\times B"}]]}]}]}],["$","span",null,{"className":"katex-html","aria-hidden":"true","children":[["$","span",null,{"className":"base","children":[["$","span",null,{"className":"strut","style":{"height":"0.7667em","verticalAlign":"-0.0833em"}}],["$","span",null,{"className":"mord mathnormal","children":"A"}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2222em"}}],["$","span",null,{"className":"mbin","children":"×"}],["$","span",null,{"className":"mspace","style":{"marginRight":"0.2222em"}}]]}],["$","span",null,{"className":"base","children":[["$","span",null,{"className":"strut","style":{"height":"0.6833em"}}],["$","span",null,{"className":"mord mathnormal","style":{"marginRight":"0.05017em"},"children":"B"}]]}]]}]]}]," pair matching with similarity tests over a couple of parameters that take 1 second would have me processing the set for… about 25,684 years. A gentle reminder that:"]}],"\n",["$","$L1b",null,{"src":"./96dz0h.jpg","alt":"Big Oh N squared is bad, and you should feel bad -- a Zoidberg meme, very mature...","caption":"Very mature meme","attribution":"Original idea captioned in [memegenerator](https://imgflip.com/memegenerator/)","postSlug":"/blog/2024/notebook_multiprocessing"}],"\n",["$","div",null,{"className":"MarkdownHeading_markdown-heading__G6B4T","children":[["$","span",null,{"className":"MarkdownHeading_markdown-hash__CheR_","children":["##"," "]}],["$","span",null,{"children":"Multiprocessing"}]]}],"\n",["$","p",null,{"children":["So what do you do when you have so much crunching to do that you want to utilize all CPU cores? That’s when ",["$","a",null,{"href":"https://docs.python.org/3/library/concurrent.futures.html#processpoolexecutor","children":null}]," steps in to save the day. For those unfamiliar, ",null," is like that friend who helps you move heavy furniture; it lives in the ",["$","a",null,{"href":"https://docs.python.org/3/library/concurrent.futures.html","children":null}]," package of the standard Python library and, much like ",["$","a",null,{"href":"https://docs.python.org/3/library/concurrent.futures.html#threadpoolexecutor","children":null}],", lets you distribute workload across a pool of workers. The difference is, these workers are separate processes, not threads."]}],"\n",["$","p",null,{"children":["With both ",["$","em",null,{"children":"threads"}]," and ",["$","em",null,{"children":"processes"}],", the API looks innocently simple: you just pass the function that will be called by each worker with a piece of data:"]}],"\n",["","$L1c"],"\n",["$","p",null,{"children":["For ",["$","em",null,{"children":"threads"}],", that's pretty much it—you can pat yourself on the back and watch your CPU stay underutilized. But ",["$","a",null,{"href":"https://stackoverflow.com/questions/4496680/python-threads-all-executing-on-a-single-core","children":"threads aren't going to use all your cores"}]," due to the infamous Global Interpreter Lock (GIL). So what if we swap ",null," for ",null," to really get the party started? We get an exception immediately."]}],"\n",["","$L1d"],"\n",["$","p",null,{"children":["What happened? Well, the first rule of multiprocessing is that it uses ",["$","a",null,{"href":"https:z//docs.python.org/3/library/pickle.html","children":null}]," to serialize a function and data between the parent process and child processes. And pickle's ",["$","a",null,{"href":"https://docs.python.org/3/library/pickle.html","children":"documentation"}]," says:"]}],"\n",["$","blockquote",null,{"children":["\n",["$","p",null,{"children":["Note that functions (built-in and user-defined) are pickled by ",["$","strong",null,{"children":"fully qualified name"}],", not by value.\nThis means that only the function name is pickled, along with the name of the containing module and classes.\nNeither the function's code, nor any of its function attributes are pickled."]}],"\n"]}],"\n",["$","p",null,{"children":["Since all lambdas share the same name -- ",null," -- that explains why we need to define a proper method:"]}],"\n",["","$L1e"],"\n",["$","p",null,{"children":["Now it works, but that error above has one little, less obvious consequence. If we only send a ",["$","em",null,{"children":"fully qualified name"}]," over to another process, then how does the method get called?"]}],"\n",["$","p",null,{"children":["When the ",null," module starts a new child process, it doesn't have access to your current interactive namespace. It's like sending someone to fetch an item from your house without giving them the address—they need to know where to look."]}],"\n",["$","p",null,{"children":["Under the hood, when multiprocessing starts a new child process, it uses ",null," on Windows and macOS. On POSIX systems, it's still using fork, although since Python 3.12 it'll throw a ",null,". Fork is a bit problematic from a safety point of view, as the child process inherits everything from the parent process. Spawn, on the other hand, starts a completely fresh Python interpreter process."]}],"\n",["$","p",null,{"children":"This means that any variables or functions you've defined interactively in your Jupyter Notebook aren't automatically available in the child processes. They're starting from scratch, and unless your function is defined in a module they can import, they're left in the dark."}],"\n",["$","p",null,{"children":["Here's a rough diagram, courtesy of the Python ",["$","a",null,{"href":"https://github.com/python/cpython/blob/main/Lib/concurrent/futures/process.py","children":"docs"}],", of how the flow looks when you submit work to the process pool:"]}],"\n",["$","div",null,{"className":"goat-diagram-wrapper","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","version":"1.1","height":"313","width":"656","fontFamily":"Menlo,Lucida Console,monospace","viewBox":"0 0 656 313","preserveAspectRatio":"xMidYMid meet","children":["\n",["$","style",null,{"type":"text/css","children":"\nsvg {\n   color: #000000;\n}\n@media (prefers-color-scheme: dark) {\n   svg {\n      color-scheme: dark; /* ask the browser for a dark background */\n      color: #FFFFFF;\n   }\n}\n"}],"\n",["$","g",null,{"transform":"translate(8,16)","children":["\n",["$","path",null,{"d":"M 0,16 L 88,16","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 136,16 L 224,16","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 288,16 L 360,16","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 408,16 L 504,16","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 552,16 L 632,16","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 96,32 L 128,32","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 136,64 L 224,64","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 408,64 L 504,64","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 552,64 L 632,64","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 232,96 L 280,96","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 368,96 L 400,96","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 512,96 L 544,96","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 408,128 L 504,128","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 136,144 L 224,144","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 136,176 L 240,176","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 408,176 L 504,176","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 96,192 L 128,192","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 248,192 L 280,192","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 368,192 L 400,192","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 512,192 L 544,192","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 136,208 L 240,208","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 408,224 L 504,224","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 0,288 L 88,288","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 136,288 L 240,288","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 288,288 L 360,288","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 408,288 L 504,288","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 552,288 L 632,288","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 0,0 L 0,16","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 0,16 L 0,288","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 88,16 L 88,288","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 136,16 L 136,64","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 136,64 L 136,144","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 136,176 L 136,208","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 136,208 L 136,288","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 224,16 L 224,64","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 224,64 L 224,144","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 240,176 L 240,208","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 240,208 L 240,288","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 288,16 L 288,288","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 360,16 L 360,288","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 408,16 L 408,64","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 408,64 L 408,128","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 408,176 L 408,224","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 408,224 L 408,288","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 504,16 L 504,64","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 504,64 L 504,128","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 504,176 L 504,224","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 504,224 L 504,288","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 552,16 L 552,64","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 552,64 L 552,288","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 632,0 L 632,16","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 632,16 L 632,64","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 632,64 L 632,288","fill":"none","stroke":"currentColor"}],"\n",["$","polygon",null,{"points":"104.000000,192.000000 92.000000,186.399994 92.000000,197.600006","fill":"currentColor","transform":"rotate(180.000000, 96.000000, 192.000000)"}],"\n",["$","polygon",null,{"points":"136.000000,32.000000 124.000000,26.400000 124.000000,37.599998","fill":"currentColor","transform":"rotate(0.000000, 128.000000, 32.000000)"}],"\n",["$","polygon",null,{"points":"136.000000,192.000000 124.000000,186.399994 124.000000,197.600006","fill":"currentColor","transform":"rotate(0.000000, 128.000000, 192.000000)"}],"\n",["$","polygon",null,{"points":"256.000000,192.000000 244.000000,186.399994 244.000000,197.600006","fill":"currentColor","transform":"rotate(180.000000, 248.000000, 192.000000)"}],"\n",["$","polygon",null,{"points":"288.000000,96.000000 276.000000,90.400002 276.000000,101.599998","fill":"currentColor","transform":"rotate(0.000000, 280.000000, 96.000000)"}],"\n",["$","polygon",null,{"points":"288.000000,192.000000 276.000000,186.399994 276.000000,197.600006","fill":"currentColor","transform":"rotate(0.000000, 280.000000, 192.000000)"}],"\n",["$","polygon",null,{"points":"376.000000,192.000000 364.000000,186.399994 364.000000,197.600006","fill":"currentColor","transform":"rotate(180.000000, 368.000000, 192.000000)"}],"\n",["$","polygon",null,{"points":"408.000000,96.000000 396.000000,90.400002 396.000000,101.599998","fill":"currentColor","transform":"rotate(0.000000, 400.000000, 96.000000)"}],"\n",["$","polygon",null,{"points":"520.000000,192.000000 508.000000,186.399994 508.000000,197.600006","fill":"currentColor","transform":"rotate(180.000000, 512.000000, 192.000000)"}],"\n",["$","polygon",null,{"points":"552.000000,96.000000 540.000000,90.400002 540.000000,101.599998","fill":"currentColor","transform":"rotate(0.000000, 544.000000, 96.000000)"}],"\n",["$","style",null,{"children":"\n  text {\n       text-anchor: middle;\n       font-family: \"Menlo\",\"Lucida Console\",\"monospace\";\n       fill: currentColor;\n       font-size: 1em;\n  }\n"}],"\n",["$","text",null,{"x":"8","y":"4","children":"="}],"\n",["$","text",null,{"x":"16","y":"4","children":"="}],"\n",["$","text",null,{"x":"24","y":"4","children":"="}],"\n",["$","text",null,{"x":"32","y":"4","children":"="}],"\n",["$","text",null,{"x":"40","y":"4","children":"="}],"\n",["$","text",null,{"x":"48","y":"4","children":"="}],"\n",["$","text",null,{"x":"56","y":"4","children":"="}],"\n",["$","text",null,{"x":"64","y":"4","children":"="}],"\n",["$","text",null,{"x":"72","y":"4","children":"="}],"\n",["$","text",null,{"x":"80","y":"4","children":"="}],"\n",["$","text",null,{"x":"88","y":"4","children":"="}],"\n",["$","text",null,{"x":"96","y":"4","children":"="}],"\n",["$","text",null,{"x":"104","y":"4","children":"="}],"\n",["$","text",null,{"x":"112","y":"4","children":"="}],"\n",["$","text",null,{"x":"120","y":"4","children":"="}],"\n",["$","text",null,{"x":"128","y":"4","children":"="}],"\n",["$","text",null,{"x":"136","y":"4","children":"="}],"\n",["$","text",null,{"x":"144","y":"4","children":"="}],"\n",["$","text",null,{"x":"152","y":"4","children":"="}],"\n",["$","text",null,{"x":"160","y":"4","children":"="}],"\n",["$","text",null,{"x":"168","y":"4","children":"="}],"\n",["$","text",null,{"x":"176","y":"4","children":"="}],"\n",["$","text",null,{"x":"184","y":"4","children":"="}],"\n",["$","text",null,{"x":"200","y":"4","children":"I"}],"\n",["$","text",null,{"x":"208","y":"4","children":"n"}],"\n",["$","text",null,{"x":"216","y":"4","children":"-"}],"\n",["$","text",null,{"x":"224","y":"4","children":"p"}],"\n",["$","text",null,{"x":"232","y":"4","children":"r"}],"\n",["$","text",null,{"x":"240","y":"4","children":"o"}],"\n",["$","text",null,{"x":"248","y":"4","children":"c"}],"\n",["$","text",null,{"x":"256","y":"4","children":"e"}],"\n",["$","text",null,{"x":"264","y":"4","children":"s"}],"\n",["$","text",null,{"x":"272","y":"4","children":"s"}],"\n",["$","text",null,{"x":"288","y":"4","children":"="}],"\n",["$","text",null,{"x":"296","y":"4","children":"="}],"\n",["$","text",null,{"x":"304","y":"4","children":"="}],"\n",["$","text",null,{"x":"312","y":"4","children":"="}],"\n",["$","text",null,{"x":"320","y":"4","children":"="}],"\n",["$","text",null,{"x":"328","y":"4","children":"="}],"\n",["$","text",null,{"x":"336","y":"4","children":"="}],"\n",["$","text",null,{"x":"344","y":"4","children":"="}],"\n",["$","text",null,{"x":"352","y":"4","children":"="}],"\n",["$","text",null,{"x":"360","y":"4","children":"="}],"\n",["$","text",null,{"x":"368","y":"4","children":"="}],"\n",["$","text",null,{"x":"376","y":"4","children":"="}],"\n",["$","text",null,{"x":"384","y":"4","children":"="}],"\n",["$","text",null,{"x":"392","y":"4","children":"="}],"\n",["$","text",null,{"x":"400","y":"4","children":"="}],"\n",["$","text",null,{"x":"408","y":"4","children":"="}],"\n",["$","text",null,{"x":"416","y":"4","children":"="}],"\n",["$","text",null,{"x":"424","y":"4","children":"="}],"\n",["$","text",null,{"x":"432","y":"4","children":"="}],"\n",["$","text",null,{"x":"440","y":"4","children":"="}],"\n",["$","text",null,{"x":"448","y":"4","children":"="}],"\n",["$","text",null,{"x":"456","y":"4","children":"="}],"\n",["$","text",null,{"x":"464","y":"4","children":"|"}],"\n",["$","text",null,{"x":"472","y":"4","children":"="}],"\n",["$","text",null,{"x":"480","y":"4","children":"="}],"\n",["$","text",null,{"x":"496","y":"4","children":"O"}],"\n",["$","text",null,{"x":"504","y":"4","children":"u"}],"\n",["$","text",null,{"x":"512","y":"4","children":"t"}],"\n",["$","text",null,{"x":"520","y":"4","children":"-"}],"\n",["$","text",null,{"x":"528","y":"4","children":"o"}],"\n",["$","text",null,{"x":"536","y":"4","children":"f"}],"\n",["$","text",null,{"x":"544","y":"4","children":"-"}],"\n",["$","text",null,{"x":"552","y":"4","children":"p"}],"\n",["$","text",null,{"x":"560","y":"4","children":"r"}],"\n",["$","text",null,{"x":"568","y":"4","children":"o"}],"\n",["$","text",null,{"x":"576","y":"4","children":"c"}],"\n",["$","text",null,{"x":"584","y":"4","children":"e"}],"\n",["$","text",null,{"x":"592","y":"4","children":"s"}],"\n",["$","text",null,{"x":"600","y":"4","children":"s"}],"\n",["$","text",null,{"x":"616","y":"4","children":"="}],"\n",["$","text",null,{"x":"624","y":"4","children":"="}],"\n",["$","text",null,{"x":"152","y":"36","children":"W"}],"\n",["$","text",null,{"x":"160","y":"36","children":"o"}],"\n",["$","text",null,{"x":"168","y":"36","children":"r"}],"\n",["$","text",null,{"x":"176","y":"36","children":"k"}],"\n",["$","text",null,{"x":"192","y":"36","children":"I"}],"\n",["$","text",null,{"x":"200","y":"36","children":"d"}],"\n",["$","text",null,{"x":"208","y":"36","children":"s"}],"\n",["$","text",null,{"x":"440","y":"36","children":"C"}],"\n",["$","text",null,{"x":"448","y":"36","children":"a"}],"\n",["$","text",null,{"x":"456","y":"36","children":"l"}],"\n",["$","text",null,{"x":"464","y":"36","children":"l"}],"\n",["$","text",null,{"x":"568","y":"36","children":"P"}],"\n",["$","text",null,{"x":"576","y":"36","children":"r"}],"\n",["$","text",null,{"x":"584","y":"36","children":"o"}],"\n",["$","text",null,{"x":"592","y":"36","children":"c"}],"\n",["$","text",null,{"x":"600","y":"36","children":"e"}],"\n",["$","text",null,{"x":"608","y":"36","children":"s"}],"\n",["$","text",null,{"x":"616","y":"36","children":"s"}],"\n",["$","text",null,{"x":"440","y":"52","children":"Q"}],"\n",["$","text",null,{"x":"448","y":"52","children":"u"}],"\n",["$","text",null,{"x":"456","y":"52","children":"e"}],"\n",["$","text",null,{"x":"464","y":"52","children":"u"}],"\n",["$","text",null,{"x":"472","y":"52","children":"e"}],"\n",["$","text",null,{"x":"576","y":"52","children":"P"}],"\n",["$","text",null,{"x":"584","y":"52","children":"o"}],"\n",["$","text",null,{"x":"592","y":"52","children":"o"}],"\n",["$","text",null,{"x":"600","y":"52","children":"l"}],"\n",["$","text",null,{"x":"152","y":"84","children":"."}],"\n",["$","text",null,{"x":"160","y":"84","children":"."}],"\n",["$","text",null,{"x":"168","y":"84","children":"."}],"\n",["$","text",null,{"x":"424","y":"84","children":"."}],"\n",["$","text",null,{"x":"432","y":"84","children":"."}],"\n",["$","text",null,{"x":"440","y":"84","children":"."}],"\n",["$","text",null,{"x":"152","y":"100","children":"6"}],"\n",["$","text",null,{"x":"424","y":"100","children":"5"}],"\n",["$","text",null,{"x":"432","y":"100","children":","}],"\n",["$","text",null,{"x":"448","y":"100","children":"c"}],"\n",["$","text",null,{"x":"456","y":"100","children":"a"}],"\n",["$","text",null,{"x":"464","y":"100","children":"l"}],"\n",["$","text",null,{"x":"472","y":"100","children":"l"}],"\n",["$","text",null,{"x":"480","y":"100","children":"("}],"\n",["$","text",null,{"x":"488","y":"100","children":")"}],"\n",["$","text",null,{"x":"152","y":"116","children":"7"}],"\n",["$","text",null,{"x":"424","y":"116","children":"."}],"\n",["$","text",null,{"x":"432","y":"116","children":"."}],"\n",["$","text",null,{"x":"440","y":"116","children":"."}],"\n",["$","text",null,{"x":"16","y":"132","children":"P"}],"\n",["$","text",null,{"x":"24","y":"132","children":"r"}],"\n",["$","text",null,{"x":"32","y":"132","children":"o"}],"\n",["$","text",null,{"x":"40","y":"132","children":"c"}],"\n",["$","text",null,{"x":"48","y":"132","children":"e"}],"\n",["$","text",null,{"x":"56","y":"132","children":"s"}],"\n",["$","text",null,{"x":"64","y":"132","children":"s"}],"\n",["$","text",null,{"x":"152","y":"132","children":"."}],"\n",["$","text",null,{"x":"160","y":"132","children":"."}],"\n",["$","text",null,{"x":"168","y":"132","children":"."}],"\n",["$","text",null,{"x":"304","y":"132","children":"L"}],"\n",["$","text",null,{"x":"312","y":"132","children":"o"}],"\n",["$","text",null,{"x":"320","y":"132","children":"c"}],"\n",["$","text",null,{"x":"328","y":"132","children":"a"}],"\n",["$","text",null,{"x":"336","y":"132","children":"l"}],"\n",["$","text",null,{"x":"568","y":"132","children":"P"}],"\n",["$","text",null,{"x":"576","y":"132","children":"r"}],"\n",["$","text",null,{"x":"584","y":"132","children":"o"}],"\n",["$","text",null,{"x":"592","y":"132","children":"c"}],"\n",["$","text",null,{"x":"600","y":"132","children":"e"}],"\n",["$","text",null,{"x":"608","y":"132","children":"s"}],"\n",["$","text",null,{"x":"616","y":"132","children":"s"}],"\n",["$","text",null,{"x":"24","y":"148","children":"P"}],"\n",["$","text",null,{"x":"32","y":"148","children":"o"}],"\n",["$","text",null,{"x":"40","y":"148","children":"o"}],"\n",["$","text",null,{"x":"48","y":"148","children":"l"}],"\n",["$","text",null,{"x":"304","y":"148","children":"W"}],"\n",["$","text",null,{"x":"312","y":"148","children":"o"}],"\n",["$","text",null,{"x":"320","y":"148","children":"r"}],"\n",["$","text",null,{"x":"328","y":"148","children":"k"}],"\n",["$","text",null,{"x":"336","y":"148","children":"e"}],"\n",["$","text",null,{"x":"344","y":"148","children":"r"}],"\n",["$","text",null,{"x":"576","y":"148","children":"#"}],"\n",["$","text",null,{"x":"584","y":"148","children":"1"}],"\n",["$","text",null,{"x":"592","y":"148","children":"."}],"\n",["$","text",null,{"x":"600","y":"148","children":"."}],"\n",["$","text",null,{"x":"608","y":"148","children":"n"}],"\n",["$","text",null,{"x":"16","y":"164","children":"E"}],"\n",["$","text",null,{"x":"24","y":"164","children":"x"}],"\n",["$","text",null,{"x":"32","y":"164","children":"e"}],"\n",["$","text",null,{"x":"40","y":"164","children":"c"}],"\n",["$","text",null,{"x":"48","y":"164","children":"u"}],"\n",["$","text",null,{"x":"56","y":"164","children":"t"}],"\n",["$","text",null,{"x":"64","y":"164","children":"o"}],"\n",["$","text",null,{"x":"72","y":"164","children":"r"}],"\n",["$","text",null,{"x":"304","y":"164","children":"T"}],"\n",["$","text",null,{"x":"312","y":"164","children":"h"}],"\n",["$","text",null,{"x":"320","y":"164","children":"r"}],"\n",["$","text",null,{"x":"328","y":"164","children":"e"}],"\n",["$","text",null,{"x":"336","y":"164","children":"a"}],"\n",["$","text",null,{"x":"344","y":"164","children":"d"}],"\n",["$","text",null,{"x":"152","y":"196","children":"W"}],"\n",["$","text",null,{"x":"160","y":"196","children":"o"}],"\n",["$","text",null,{"x":"168","y":"196","children":"r"}],"\n",["$","text",null,{"x":"176","y":"196","children":"k"}],"\n",["$","text",null,{"x":"192","y":"196","children":"I"}],"\n",["$","text",null,{"x":"200","y":"196","children":"t"}],"\n",["$","text",null,{"x":"208","y":"196","children":"e"}],"\n",["$","text",null,{"x":"216","y":"196","children":"m"}],"\n",["$","text",null,{"x":"224","y":"196","children":"s"}],"\n",["$","text",null,{"x":"432","y":"196","children":"R"}],"\n",["$","text",null,{"x":"440","y":"196","children":"e"}],"\n",["$","text",null,{"x":"448","y":"196","children":"s"}],"\n",["$","text",null,{"x":"456","y":"196","children":"u"}],"\n",["$","text",null,{"x":"464","y":"196","children":"l"}],"\n",["$","text",null,{"x":"472","y":"196","children":"t"}],"\n",["$","text",null,{"x":"432","y":"212","children":"Q"}],"\n",["$","text",null,{"x":"440","y":"212","children":"u"}],"\n",["$","text",null,{"x":"448","y":"212","children":"e"}],"\n",["$","text",null,{"x":"456","y":"212","children":"u"}],"\n",["$","text",null,{"x":"464","y":"212","children":"e"}],"\n",["$","text",null,{"x":"152","y":"244","children":"6"}],"\n",["$","text",null,{"x":"160","y":"244","children":":"}],"\n",["$","text",null,{"x":"176","y":"244","children":"c"}],"\n",["$","text",null,{"x":"184","y":"244","children":"a"}],"\n",["$","text",null,{"x":"192","y":"244","children":"l"}],"\n",["$","text",null,{"x":"200","y":"244","children":"l"}],"\n",["$","text",null,{"x":"208","y":"244","children":"("}],"\n",["$","text",null,{"x":"216","y":"244","children":")"}],"\n",["$","text",null,{"x":"424","y":"244","children":"."}],"\n",["$","text",null,{"x":"432","y":"244","children":"."}],"\n",["$","text",null,{"x":"440","y":"244","children":"."}],"\n",["$","text",null,{"x":"176","y":"260","children":"f"}],"\n",["$","text",null,{"x":"184","y":"260","children":"u"}],"\n",["$","text",null,{"x":"192","y":"260","children":"t"}],"\n",["$","text",null,{"x":"200","y":"260","children":"u"}],"\n",["$","text",null,{"x":"208","y":"260","children":"r"}],"\n",["$","text",null,{"x":"216","y":"260","children":"e"}],"\n",["$","text",null,{"x":"424","y":"260","children":"4"}],"\n",["$","text",null,{"x":"432","y":"260","children":","}],"\n",["$","text",null,{"x":"448","y":"260","children":"r"}],"\n",["$","text",null,{"x":"456","y":"260","children":"e"}],"\n",["$","text",null,{"x":"464","y":"260","children":"s"}],"\n",["$","text",null,{"x":"472","y":"260","children":"u"}],"\n",["$","text",null,{"x":"480","y":"260","children":"l"}],"\n",["$","text",null,{"x":"488","y":"260","children":"t"}],"\n",["$","text",null,{"x":"152","y":"276","children":"."}],"\n",["$","text",null,{"x":"160","y":"276","children":"."}],"\n",["$","text",null,{"x":"168","y":"276","children":"."}],"\n",["$","text",null,{"x":"424","y":"276","children":"3"}],"\n",["$","text",null,{"x":"432","y":"276","children":","}],"\n",["$","text",null,{"x":"448","y":"276","children":"e"}],"\n",["$","text",null,{"x":"456","y":"276","children":"x"}],"\n",["$","text",null,{"x":"464","y":"276","children":"c"}],"\n",["$","text",null,{"x":"472","y":"276","children":"e"}],"\n",["$","text",null,{"x":"480","y":"276","children":"p"}],"\n",["$","text",null,{"x":"488","y":"276","children":"t"}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","p",null,{"children":["When you call a ",null,", it internally calls ",["$","a",null,{"href":"https://github.com/python/cpython/blob/main/Lib/concurrent/futures/process.py#L791","children":"submit"}],", which converts your function, its parameters, and the data into a structure called ",null," and adds it to a ",null,". In a run-loop, it then pops those work items, and if they're not canceled, it repackages them into a structure ",null," and puts it on a ",null,". The ",["$","a",null,{"href":"https://github.com/python/cpython/blob/main/Lib/multiprocessing/queues.py#L262","children":null}]," handles ",null," serialization before writing the data. It's up to pickle to get the ",["$","em",null,{"children":"fully qualified name"}]," of the function being serialized, and while doing that (and also when deserializing), pickle actually tries to ",["$","a",null,{"href":"https://github.com/python/cpython/blob/3.13/Lib/pickle.py#L1082","children":"import the module"}]," a function is part of:"]}],"\n",[["$","div",null,{"className":"code-filename","children":["$","span",null,{"children":"Lib/pickle.py"}]}],"$L1f"],"\n",["$","p",null,{"children":"That brings us to a very important requirement which is:"}],"\n",["$","$L20",null,{"type":"important","title":"IMPORTANT","children":["$","p",null,{"children":["A function that we pass to executor must be visible via ",null]}]}],"\n",["$","p",null,{"children":["When you submit a function to ",null,", the function and its arguments are pickled to be sent to the worker process. The pickling process relies on the function being defined at the module level with a name accessible via importing."]}],"\n",["$","div",null,{"className":"MarkdownHeading_markdown-heading__G6B4T","children":[["$","span",null,{"className":"MarkdownHeading_markdown-hash__CheR_","children":["##"," "]}],["$","span",null,{"children":"Enter Jupyter Notebook"}]]}],"\n",["$","p",null,{"children":"The problem is, Jupyter Notebooks, aside from being a JSON document, execute code dynamically. Let's see how it works:"}],"\n",["$","div",null,{"className":"goat-diagram-wrapper","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","version":"1.1","height":"201","width":"640","fontFamily":"Menlo,Lucida Console,monospace","viewBox":"0 0 640 201","preserveAspectRatio":"xMidYMid meet","children":["\n",["$","style",null,{"type":"text/css","children":"\nsvg {\n   color: #000000;\n}\n@media (prefers-color-scheme: dark) {\n   svg {\n      color-scheme: dark; /* ask the browser for a dark background */\n      color: #FFFFFF;\n   }\n}\n"}],"\n",["$","g",null,{"transform":"translate(8,16)","children":["\n",["$","path",null,{"d":"M 0,16 L 88,16","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 152,16 L 280,16","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 344,16 L 448,16","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 504,16 L 616,16","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 152,48 L 280,48","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 96,64 L 144,64","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 344,64 L 448,64","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 504,64 L 616,64","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 288,80 L 336,80","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 456,80 L 496,80","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 152,112 L 280,112","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 96,144 L 144,144","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 288,144 L 336,144","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 456,144 L 496,144","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 0,176 L 88,176","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 152,176 L 280,176","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 344,176 L 448,176","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 504,176 L 616,176","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 0,0 L 0,16","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 0,16 L 0,176","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 88,16 L 88,176","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 152,16 L 152,48","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 152,48 L 152,112","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 152,112 L 152,176","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 280,16 L 280,48","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 280,48 L 280,112","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 280,112 L 280,176","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 344,16 L 344,64","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 344,64 L 344,176","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 448,16 L 448,64","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 448,64 L 448,176","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 504,0 L 504,16","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 504,16 L 504,64","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 504,64 L 504,176","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 616,0 L 616,16","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 616,16 L 616,64","fill":"none","stroke":"currentColor"}],"\n",["$","path",null,{"d":"M 616,64 L 616,176","fill":"none","stroke":"currentColor"}],"\n",["$","polygon",null,{"points":"104.000000,144.000000 92.000000,138.399994 92.000000,149.600006","fill":"currentColor","transform":"rotate(180.000000, 96.000000, 144.000000)"}],"\n",["$","polygon",null,{"points":"152.000000,64.000000 140.000000,58.400002 140.000000,69.599998","fill":"currentColor","transform":"rotate(0.000000, 144.000000, 64.000000)"}],"\n",["$","polygon",null,{"points":"296.000000,144.000000 284.000000,138.399994 284.000000,149.600006","fill":"currentColor","transform":"rotate(180.000000, 288.000000, 144.000000)"}],"\n",["$","polygon",null,{"points":"344.000000,80.000000 332.000000,74.400002 332.000000,85.599998","fill":"currentColor","transform":"rotate(0.000000, 336.000000, 80.000000)"}],"\n",["$","polygon",null,{"points":"464.000000,144.000000 452.000000,138.399994 452.000000,149.600006","fill":"currentColor","transform":"rotate(180.000000, 456.000000, 144.000000)"}],"\n",["$","polygon",null,{"points":"504.000000,80.000000 492.000000,74.400002 492.000000,85.599998","fill":"currentColor","transform":"rotate(0.000000, 496.000000, 80.000000)"}],"\n",["$","style",null,{"children":"\n  text {\n       text-anchor: middle;\n       font-family: \"Menlo\",\"Lucida Console\",\"monospace\";\n       fill: currentColor;\n       font-size: 1em;\n  }\n"}],"\n",["$","text",null,{"x":"8","y":"4","children":"="}],"\n",["$","text",null,{"x":"16","y":"4","children":"="}],"\n",["$","text",null,{"x":"24","y":"4","children":"="}],"\n",["$","text",null,{"x":"32","y":"4","children":"="}],"\n",["$","text",null,{"x":"40","y":"4","children":"="}],"\n",["$","text",null,{"x":"48","y":"4","children":"="}],"\n",["$","text",null,{"x":"56","y":"4","children":"="}],"\n",["$","text",null,{"x":"64","y":"4","children":"="}],"\n",["$","text",null,{"x":"72","y":"4","children":"="}],"\n",["$","text",null,{"x":"80","y":"4","children":"="}],"\n",["$","text",null,{"x":"88","y":"4","children":"="}],"\n",["$","text",null,{"x":"96","y":"4","children":"J"}],"\n",["$","text",null,{"x":"104","y":"4","children":"u"}],"\n",["$","text",null,{"x":"112","y":"4","children":"p"}],"\n",["$","text",null,{"x":"120","y":"4","children":"y"}],"\n",["$","text",null,{"x":"128","y":"4","children":"t"}],"\n",["$","text",null,{"x":"136","y":"4","children":"e"}],"\n",["$","text",null,{"x":"144","y":"4","children":"r"}],"\n",["$","text",null,{"x":"152","y":"4","children":"="}],"\n",["$","text",null,{"x":"160","y":"4","children":"="}],"\n",["$","text",null,{"x":"168","y":"4","children":"="}],"\n",["$","text",null,{"x":"176","y":"4","children":"="}],"\n",["$","text",null,{"x":"184","y":"4","children":"="}],"\n",["$","text",null,{"x":"192","y":"4","children":"="}],"\n",["$","text",null,{"x":"200","y":"4","children":"="}],"\n",["$","text",null,{"x":"208","y":"4","children":"|"}],"\n",["$","text",null,{"x":"216","y":"4","children":"="}],"\n",["$","text",null,{"x":"224","y":"4","children":"="}],"\n",["$","text",null,{"x":"232","y":"4","children":"="}],"\n",["$","text",null,{"x":"240","y":"4","children":"="}],"\n",["$","text",null,{"x":"248","y":"4","children":"="}],"\n",["$","text",null,{"x":"256","y":"4","children":"="}],"\n",["$","text",null,{"x":"264","y":"4","children":"="}],"\n",["$","text",null,{"x":"272","y":"4","children":"="}],"\n",["$","text",null,{"x":"288","y":"4","children":"K"}],"\n",["$","text",null,{"x":"296","y":"4","children":"e"}],"\n",["$","text",null,{"x":"304","y":"4","children":"r"}],"\n",["$","text",null,{"x":"312","y":"4","children":"n"}],"\n",["$","text",null,{"x":"320","y":"4","children":"e"}],"\n",["$","text",null,{"x":"328","y":"4","children":"l"}],"\n",["$","text",null,{"x":"344","y":"4","children":"="}],"\n",["$","text",null,{"x":"352","y":"4","children":"="}],"\n",["$","text",null,{"x":"360","y":"4","children":"="}],"\n",["$","text",null,{"x":"368","y":"4","children":"="}],"\n",["$","text",null,{"x":"376","y":"4","children":"="}],"\n",["$","text",null,{"x":"384","y":"4","children":"="}],"\n",["$","text",null,{"x":"392","y":"4","children":"="}],"\n",["$","text",null,{"x":"400","y":"4","children":"="}],"\n",["$","text",null,{"x":"408","y":"4","children":"="}],"\n",["$","text",null,{"x":"416","y":"4","children":"="}],"\n",["$","text",null,{"x":"424","y":"4","children":"="}],"\n",["$","text",null,{"x":"432","y":"4","children":"="}],"\n",["$","text",null,{"x":"440","y":"4","children":"="}],"\n",["$","text",null,{"x":"448","y":"4","children":"="}],"\n",["$","text",null,{"x":"456","y":"4","children":"="}],"\n",["$","text",null,{"x":"464","y":"4","children":"="}],"\n",["$","text",null,{"x":"472","y":"4","children":"="}],"\n",["$","text",null,{"x":"480","y":"4","children":"="}],"\n",["$","text",null,{"x":"488","y":"4","children":"="}],"\n",["$","text",null,{"x":"496","y":"4","children":"="}],"\n",["$","text",null,{"x":"512","y":"4","children":"="}],"\n",["$","text",null,{"x":"520","y":"4","children":"="}],"\n",["$","text",null,{"x":"536","y":"4","children":"I"}],"\n",["$","text",null,{"x":"544","y":"4","children":"P"}],"\n",["$","text",null,{"x":"552","y":"4","children":"y"}],"\n",["$","text",null,{"x":"560","y":"4","children":"t"}],"\n",["$","text",null,{"x":"568","y":"4","children":"h"}],"\n",["$","text",null,{"x":"576","y":"4","children":"o"}],"\n",["$","text",null,{"x":"584","y":"4","children":"n"}],"\n",["$","text",null,{"x":"600","y":"4","children":"="}],"\n",["$","text",null,{"x":"608","y":"4","children":"="}],"\n",["$","text",null,{"x":"200","y":"36","children":"Ø"}],"\n",["$","text",null,{"x":"208","y":"36","children":"M"}],"\n",["$","text",null,{"x":"216","y":"36","children":"Q"}],"\n",["$","text",null,{"x":"368","y":"36","children":"I"}],"\n",["$","text",null,{"x":"376","y":"36","children":"P"}],"\n",["$","text",null,{"x":"384","y":"36","children":"y"}],"\n",["$","text",null,{"x":"392","y":"36","children":"t"}],"\n",["$","text",null,{"x":"400","y":"36","children":"h"}],"\n",["$","text",null,{"x":"408","y":"36","children":"o"}],"\n",["$","text",null,{"x":"416","y":"36","children":"n"}],"\n",["$","text",null,{"x":"520","y":"36","children":"I"}],"\n",["$","text",null,{"x":"528","y":"36","children":"n"}],"\n",["$","text",null,{"x":"536","y":"36","children":"t"}],"\n",["$","text",null,{"x":"544","y":"36","children":"e"}],"\n",["$","text",null,{"x":"552","y":"36","children":"r"}],"\n",["$","text",null,{"x":"560","y":"36","children":"a"}],"\n",["$","text",null,{"x":"568","y":"36","children":"c"}],"\n",["$","text",null,{"x":"576","y":"36","children":"t"}],"\n",["$","text",null,{"x":"584","y":"36","children":"i"}],"\n",["$","text",null,{"x":"592","y":"36","children":"v"}],"\n",["$","text",null,{"x":"600","y":"36","children":"e"}],"\n",["$","text",null,{"x":"368","y":"52","children":"K"}],"\n",["$","text",null,{"x":"376","y":"52","children":"e"}],"\n",["$","text",null,{"x":"384","y":"52","children":"r"}],"\n",["$","text",null,{"x":"392","y":"52","children":"n"}],"\n",["$","text",null,{"x":"400","y":"52","children":"e"}],"\n",["$","text",null,{"x":"408","y":"52","children":"l"}],"\n",["$","text",null,{"x":"520","y":"52","children":"S"}],"\n",["$","text",null,{"x":"528","y":"52","children":"h"}],"\n",["$","text",null,{"x":"536","y":"52","children":"e"}],"\n",["$","text",null,{"x":"544","y":"52","children":"l"}],"\n",["$","text",null,{"x":"552","y":"52","children":"l"}],"\n",["$","text",null,{"x":"168","y":"84","children":"e"}],"\n",["$","text",null,{"x":"176","y":"84","children":"x"}],"\n",["$","text",null,{"x":"184","y":"84","children":"e"}],"\n",["$","text",null,{"x":"192","y":"84","children":"c"}],"\n",["$","text",null,{"x":"200","y":"84","children":"u"}],"\n",["$","text",null,{"x":"208","y":"84","children":"t"}],"\n",["$","text",null,{"x":"216","y":"84","children":"e"}],"\n",["$","text",null,{"x":"224","y":"84","children":"_"}],"\n",["$","text",null,{"x":"232","y":"84","children":"c"}],"\n",["$","text",null,{"x":"240","y":"84","children":"o"}],"\n",["$","text",null,{"x":"248","y":"84","children":"d"}],"\n",["$","text",null,{"x":"256","y":"84","children":"e"}],"\n",["$","text",null,{"x":"16","y":"100","children":"F"}],"\n",["$","text",null,{"x":"24","y":"100","children":"r"}],"\n",["$","text",null,{"x":"32","y":"100","children":"o"}],"\n",["$","text",null,{"x":"40","y":"100","children":"n"}],"\n",["$","text",null,{"x":"48","y":"100","children":"t"}],"\n",["$","text",null,{"x":"56","y":"100","children":"e"}],"\n",["$","text",null,{"x":"64","y":"100","children":"n"}],"\n",["$","text",null,{"x":"72","y":"100","children":"d"}],"\n",["$","text",null,{"x":"360","y":"116","children":"d"}],"\n",["$","text",null,{"x":"368","y":"116","children":"o"}],"\n",["$","text",null,{"x":"376","y":"116","children":"_"}],"\n",["$","text",null,{"x":"384","y":"116","children":"e"}],"\n",["$","text",null,{"x":"392","y":"116","children":"x"}],"\n",["$","text",null,{"x":"400","y":"116","children":"e"}],"\n",["$","text",null,{"x":"408","y":"116","children":"c"}],"\n",["$","text",null,{"x":"416","y":"116","children":"u"}],"\n",["$","text",null,{"x":"424","y":"116","children":"t"}],"\n",["$","text",null,{"x":"432","y":"116","children":"e"}],"\n",["$","text",null,{"x":"528","y":"116","children":"r"}],"\n",["$","text",null,{"x":"536","y":"116","children":"u"}],"\n",["$","text",null,{"x":"544","y":"116","children":"n"}],"\n",["$","text",null,{"x":"552","y":"116","children":"_"}],"\n",["$","text",null,{"x":"560","y":"116","children":"c"}],"\n",["$","text",null,{"x":"568","y":"116","children":"e"}],"\n",["$","text",null,{"x":"576","y":"116","children":"l"}],"\n",["$","text",null,{"x":"584","y":"116","children":"l"}],"\n",["$","text",null,{"x":"168","y":"148","children":"r"}],"\n",["$","text",null,{"x":"176","y":"148","children":"e"}],"\n",["$","text",null,{"x":"184","y":"148","children":"p"}],"\n",["$","text",null,{"x":"192","y":"148","children":"l"}],"\n",["$","text",null,{"x":"200","y":"148","children":"y"}],"\n",["$","text",null,{"x":"208","y":"148","children":"_"}],"\n",["$","text",null,{"x":"216","y":"148","children":"c"}],"\n",["$","text",null,{"x":"224","y":"148","children":"o"}],"\n",["$","text",null,{"x":"232","y":"148","children":"n"}],"\n",["$","text",null,{"x":"240","y":"148","children":"t"}],"\n",["$","text",null,{"x":"248","y":"148","children":"e"}],"\n",["$","text",null,{"x":"256","y":"148","children":"n"}],"\n",["$","text",null,{"x":"264","y":"148","children":"t"}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","p",null,{"children":"The frontend sends the cell code as text to the kernel:"}],"\n",[["$","div",null,{"className":"code-filename","children":["$","span",null,{"children":"ipykernel/kernelbase.py"}]}],"$L21"],"\n",["$","p",null,{"children":["The kernel then decides how to interpret the text of the cell and what to do with it. The IPython Kernel, as the name suggests, runs the ",null," interactive shell, so it ",["$","a",null,{"href":"https://github.com/ipython/ipykernel/blob/main/ipykernel/ipkernel.py#L339","children":"sends the contents"}]," of the cell to the shell to run it:"]}],"\n",[["$","div",null,{"className":"code-filename","children":["$","span",null,{"children":"ipkernel/ipkernel.py"}]}],"$L22"],"\n",["$","p",null,{"children":["Finally, ",null," runs a separate  ",["$","a",null,{"href":"https://github.com/ipython/ipython/blob/main/IPython/core/interactiveshell.py#L3183","children":"session"}],", transforming the cell's text into an Abstract Syntax Tree (AST), compiling, and running it:"]}],"\n",[["$","div",null,{"className":"code-filename","children":["$","span",null,{"children":"IPython/core/interactiveshell.py"}]}],"$L23"],"\n",["$","p",null,{"children":["As you can see, the whole thing does not look like something that can be imported as a module. The code exists only in the interactive namespace of the ",null," shell. Hence, in order to be able to run ",null,", we must take our function, store it in a separate file—preferably somewhere in a temp folder, as a temporary module that can be imported. This way we make it accessible to child processes started by ",null,", so when ",null," tries to serialize and deserialize our function, it can successfully import it by name, and everything works smoothly."]}],"\n",["","$L24"]]
24:null
25:T38fd,<table class="code-ln-table"><tbody><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="1"><div class="code-ln-n" data-line-number="1"></div></td>
        <td class="code-ln-code" data-line-number="1"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> contextlib</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="2"><div class="code-ln-n" data-line-number="2"></div></td>
        <td class="code-ln-code" data-line-number="2"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> inspect</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="3"><div class="code-ln-n" data-line-number="3"></div></td>
        <td class="code-ln-code" data-line-number="3"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> importlib</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="4"><div class="code-ln-n" data-line-number="4"></div></td>
        <td class="code-ln-code" data-line-number="4"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pathlib</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="5"><div class="code-ln-n" data-line-number="5"></div></td>
        <td class="code-ln-code" data-line-number="5"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> sys</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="6"><div class="code-ln-n" data-line-number="6"></div></td>
        <td class="code-ln-code" data-line-number="6"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tempfile</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="7"><div class="code-ln-n" data-line-number="7"></div></td>
        <td class="code-ln-code" data-line-number="7"><span class="line"></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="8"><div class="code-ln-n" data-line-number="8"></div></td>
        <td class="code-ln-code" data-line-number="8"><span class="line"></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="9"><div class="code-ln-n" data-line-number="9"></div></td>
        <td class="code-ln-code" data-line-number="9"><span class="line"><span style="color:#6F42C1;--shiki-dark:#B392F0">@contextlib.contextmanager</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="10"><div class="code-ln-n" data-line-number="10"></div></td>
        <td class="code-ln-code" data-line-number="10"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">def</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> wrap_fn</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(fn):</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="11"><div class="code-ln-n" data-line-number="11"></div></td>
        <td class="code-ln-code" data-line-number="11"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    importlib.invalidate_caches()</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="12"><div class="code-ln-n" data-line-number="12"></div></td>
        <td class="code-ln-code" data-line-number="12"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    source </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> inspect.getsource(fn)</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="13"><div class="code-ln-n" data-line-number="13"></div></td>
        <td class="code-ln-code" data-line-number="13"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    with</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> tempfile.NamedTemporaryFile(</span><span style="color:#E36209;--shiki-dark:#FFAB70">suffix</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">".py"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">mode</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"w"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">encoding</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"utf-8"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> f:</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="14"><div class="code-ln-n" data-line-number="14"></div></td>
        <td class="code-ln-code" data-line-number="14"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        f.write(source)</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="15"><div class="code-ln-n" data-line-number="15"></div></td>
        <td class="code-ln-code" data-line-number="15"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        f.flush()</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="16"><div class="code-ln-n" data-line-number="16"></div></td>
        <td class="code-ln-code" data-line-number="16"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        path </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> pathlib.Path(f.name)</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="17"><div class="code-ln-n" data-line-number="17"></div></td>
        <td class="code-ln-code" data-line-number="17"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        directory </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> str</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(path.parent)</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="18"><div class="code-ln-n" data-line-number="18"></div></td>
        <td class="code-ln-code" data-line-number="18"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        sys.path.append(directory)</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="19"><div class="code-ln-n" data-line-number="19"></div></td>
        <td class="code-ln-code" data-line-number="19"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        module </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> importlib.import_module(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">str</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(path.stem))</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="20"><div class="code-ln-n" data-line-number="20"></div></td>
        <td class="code-ln-code" data-line-number="20"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        yield</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> getattr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(module, func.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__name__</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="21"><div class="code-ln-n" data-line-number="21"></div></td>
        <td class="code-ln-code" data-line-number="21"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        sys.path.remove(directory)</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="22"><div class="code-ln-n" data-line-number="22"></div></td>
        <td class="code-ln-code" data-line-number="22"><span class="line"></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="23"><div class="code-ln-n" data-line-number="23"></div></td>
        <td class="code-ln-code" data-line-number="23"><span class="line"></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="24"><div class="code-ln-n" data-line-number="24"></div></td>
        <td class="code-ln-code" data-line-number="24"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">def</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> square</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(x):</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="25"><div class="code-ln-n" data-line-number="25"></div></td>
        <td class="code-ln-code" data-line-number="25"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="26"><div class="code-ln-n" data-line-number="26"></div></td>
        <td class="code-ln-code" data-line-number="26"><span class="line"></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="27"><div class="code-ln-n" data-line-number="27"></div></td>
        <td class="code-ln-code" data-line-number="27"><span class="line"></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="28"><div class="code-ln-n" data-line-number="28"></div></td>
        <td class="code-ln-code" data-line-number="28"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">context </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> multiprocessing.get_context(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"spawn"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="29"><div class="code-ln-n" data-line-number="29"></div></td>
        <td class="code-ln-code" data-line-number="29"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">with</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> ProcessPoolExecutor(</span><span style="color:#E36209;--shiki-dark:#FFAB70">max_workers</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">12</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">mp_context</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">context) </span><span style="color:#D73A49;--shiki-dark:#F97583">as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> executor, wrap_fn(square) </span><span style="color:#D73A49;--shiki-dark:#F97583">as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> fn:</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="30"><div class="code-ln-n" data-line-number="30"></div></td>
        <td class="code-ln-code" data-line-number="30"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    for</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> sq </span><span style="color:#D73A49;--shiki-dark:#F97583">in</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> executor.map(fn, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">range</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">10</span><span style="color:#24292E;--shiki-dark:#E1E4E8">))</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="31"><div class="code-ln-n" data-line-number="31"></div></td>
        <td class="code-ln-code" data-line-number="31"><span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">        print</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">f</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#005CC5;--shiki-dark:#79B8FF">{</span><span style="color:#24292E;--shiki-dark:#E1E4E8">sq</span><span style="color:#005CC5;--shiki-dark:#79B8FF">}</span><span style="color:#032F62;--shiki-dark:#9ECBFF"> "</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#E36209;--shiki-dark:#FFAB70">end</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="32"><div class="code-ln-n" data-line-number="32"></div></td>
        <td class="code-ln-code" data-line-number="32"><span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">print</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#032F62;--shiki-dark:#9ECBFF">""</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span></td>
      </tr></tbody></table>1a:["$","pre",null,{"className":"language-python pre-code-block shiki github-light github-dark","children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$25"}}]}]
26:T989,<table class="code-ln-table"><tbody><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="1"><div class="code-ln-n" data-line-number="1"></div></td>
        <td class="code-ln-code" data-line-number="1"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> concurrent.futures</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="2"><div class="code-ln-n" data-line-number="2"></div></td>
        <td class="code-ln-code" data-line-number="2"><span class="line"></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="3"><div class="code-ln-n" data-line-number="3"></div></td>
        <td class="code-ln-code" data-line-number="3"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">with</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> concurrent.futures.ThreadsPoolExecutor(</span><span style="color:#E36209;--shiki-dark:#FFAB70">max_workers</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> executor:</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="4"><div class="code-ln-n" data-line-number="4"></div></td>
        <td class="code-ln-code" data-line-number="4"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    squares </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> executor.map(</span><span style="color:#D73A49;--shiki-dark:#F97583">lambda</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x: x</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">range</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">100000</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)):</span></span></td>
      </tr></tbody></table>1c:["$","pre",null,{"className":"language-python pre-code-block shiki github-light github-dark","children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$26"}}]}]
1d:["$","pre",null,{"className":"language-plaintext pre-code-block shiki github-light github-dark","children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"<table class=\"code-ln-table\"><tbody><tr class=\"code-ln-line\">\n        <td class=\"code-ln-numbers\" data-line-number=\"1\"><div class=\"code-ln-n\" data-line-number=\"1\"></div></td>\n        <td class=\"code-ln-code\" data-line-number=\"1\"><span class=\"line\"><span>_pickle.PicklingError: Can't pickle &#x3C;function &#x3C;lambda> at 0x10332e160>: </span></span></td>\n      </tr><tr class=\"code-ln-line\">\n        <td class=\"code-ln-numbers\" data-line-number=\"2\"><div class=\"code-ln-n\" data-line-number=\"2\"></div></td>\n        <td class=\"code-ln-code\" data-line-number=\"2\"><span class=\"line\"><span>  attribute lookup &#x3C;lambda> on __main__ failed</span></span></td>\n      </tr></tbody></table>"}}]}]
27:Td0a,<table class="code-ln-table"><tbody><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="1"><div class="code-ln-n" data-line-number="1"></div></td>
        <td class="code-ln-code" data-line-number="1"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">import</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> concurrent.futures</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="2"><div class="code-ln-n" data-line-number="2"></div></td>
        <td class="code-ln-code" data-line-number="2"><span class="line"></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="3"><div class="code-ln-n" data-line-number="3"></div></td>
        <td class="code-ln-code" data-line-number="3"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">def</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> square</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(x):</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="4"><div class="code-ln-n" data-line-number="4"></div></td>
        <td class="code-ln-code" data-line-number="4"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> x</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">x</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="5"><div class="code-ln-n" data-line-number="5"></div></td>
        <td class="code-ln-code" data-line-number="5"><span class="line"></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="6"><div class="code-ln-n" data-line-number="6"></div></td>
        <td class="code-ln-code" data-line-number="6"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">with</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> concurrent.futures.ThreadsPoolExecutor(</span><span style="color:#E36209;--shiki-dark:#FFAB70">max_workers</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">20</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">as</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> executor:</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="7"><div class="code-ln-n" data-line-number="7"></div></td>
        <td class="code-ln-code" data-line-number="7"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    squares </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> executor.map(square, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">range</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">100000</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)):</span></span></td>
      </tr></tbody></table>1e:["$","pre",null,{"className":"language-python pre-code-block shiki github-light github-dark","children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$27"}}]}]
28:T1bf4,<table class="code-ln-table"><tbody><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="1"><div class="code-ln-n" data-line-number="1"></div></td>
        <td class="code-ln-code" data-line-number="1"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> name </span><span style="color:#D73A49;--shiki-dark:#F97583">is</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> None</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="2"><div class="code-ln-n" data-line-number="2"></div></td>
        <td class="code-ln-code" data-line-number="2"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    name </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> getattr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(obj, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">'__qualname__'</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">None</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="3"><div class="code-ln-n" data-line-number="3"></div></td>
        <td class="code-ln-code" data-line-number="3"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> name </span><span style="color:#D73A49;--shiki-dark:#F97583">is</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> None</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="4"><div class="code-ln-n" data-line-number="4"></div></td>
        <td class="code-ln-code" data-line-number="4"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    name </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> obj.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">__name__</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="5"><div class="code-ln-n" data-line-number="5"></div></td>
        <td class="code-ln-code" data-line-number="5"><span class="line"></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="6"><div class="code-ln-n" data-line-number="6"></div></td>
        <td class="code-ln-code" data-line-number="6"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">module_name </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> whichmodule(obj, name)</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="7"><div class="code-ln-n" data-line-number="7"></div></td>
        <td class="code-ln-code" data-line-number="7"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">try</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="8"><div class="code-ln-n" data-line-number="8"></div></td>
        <td class="code-ln-code" data-line-number="8"><span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">    __import__</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(module_name, </span><span style="color:#E36209;--shiki-dark:#FFAB70">level</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">0</span><span style="color:#24292E;--shiki-dark:#E1E4E8">)</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="9"><div class="code-ln-n" data-line-number="9"></div></td>
        <td class="code-ln-code" data-line-number="9"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    module </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> sys.modules[module_name]</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="10"><div class="code-ln-n" data-line-number="10"></div></td>
        <td class="code-ln-code" data-line-number="10"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    obj2, parent </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _getattribute(module, name)</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="11"><div class="code-ln-n" data-line-number="11"></div></td>
        <td class="code-ln-code" data-line-number="11"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">except</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="color:#005CC5;--shiki-dark:#79B8FF">ImportError</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">KeyError</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span><span style="color:#005CC5;--shiki-dark:#79B8FF">AttributeError</span><span style="color:#24292E;--shiki-dark:#E1E4E8">):</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="12"><div class="code-ln-n" data-line-number="12"></div></td>
        <td class="code-ln-code" data-line-number="12"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    raise</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> PicklingError(</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="13"><div class="code-ln-n" data-line-number="13"></div></td>
        <td class="code-ln-code" data-line-number="13"><span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">        "Can't pickle </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%r</span><span style="color:#032F62;--shiki-dark:#9ECBFF">: it's not found as </span><span style="color:#005CC5;--shiki-dark:#79B8FF">%s</span><span style="color:#032F62;--shiki-dark:#9ECBFF">.</span><span style="color:#005CC5;--shiki-dark:#79B8FF">%s</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"</span><span style="color:#D73A49;--shiki-dark:#F97583"> %</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="14"><div class="code-ln-n" data-line-number="14"></div></td>
        <td class="code-ln-code" data-line-number="14"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        (obj, module_name, name)) </span><span style="color:#D73A49;--shiki-dark:#F97583">from</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> None</span></span></td>
      </tr></tbody></table>1f:["$","pre",null,{"className":"language-python pre-code-block shiki github-light github-dark","children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$28"}}]}]
29:T18c7,<table class="code-ln-table"><tbody><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="1"><div class="code-ln-n" data-line-number="1"></div></td>
        <td class="code-ln-code" data-line-number="1"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">do_execute_args </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> {</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="2"><div class="code-ln-n" data-line-number="2"></div></td>
        <td class="code-ln-code" data-line-number="2"><span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "code"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: code,</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="3"><div class="code-ln-n" data-line-number="3"></div></td>
        <td class="code-ln-code" data-line-number="3"><span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "silent"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: silent,</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="4"><div class="code-ln-n" data-line-number="4"></div></td>
        <td class="code-ln-code" data-line-number="4"><span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "store_history"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: store_history,</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="5"><div class="code-ln-n" data-line-number="5"></div></td>
        <td class="code-ln-code" data-line-number="5"><span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "user_expressions"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: user_expressions,</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="6"><div class="code-ln-n" data-line-number="6"></div></td>
        <td class="code-ln-code" data-line-number="6"><span class="line"><span style="color:#032F62;--shiki-dark:#9ECBFF">    "allow_stdin"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">: allow_stdin,</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="7"><div class="code-ln-n" data-line-number="7"></div></td>
        <td class="code-ln-code" data-line-number="7"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="8"><div class="code-ln-n" data-line-number="8"></div></td>
        <td class="code-ln-code" data-line-number="8"><span class="line"></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="9"><div class="code-ln-n" data-line-number="9"></div></td>
        <td class="code-ln-code" data-line-number="9"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">._do_exec_accepted_params[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"cell_meta"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]:</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="10"><div class="code-ln-n" data-line-number="10"></div></td>
        <td class="code-ln-code" data-line-number="10"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    do_execute_args[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"cell_meta"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> cell_meta</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="11"><div class="code-ln-n" data-line-number="11"></div></td>
        <td class="code-ln-code" data-line-number="11"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">._do_exec_accepted_params[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"cell_id"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">]:</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="12"><div class="code-ln-n" data-line-number="12"></div></td>
        <td class="code-ln-code" data-line-number="12"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    do_execute_args[</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"cell_id"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> cell_id</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="13"><div class="code-ln-n" data-line-number="13"></div></td>
        <td class="code-ln-code" data-line-number="13"><span class="line"></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="14"><div class="code-ln-n" data-line-number="14"></div></td>
        <td class="code-ln-code" data-line-number="14"><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D"># Call do_execute with the appropriate arguments</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="15"><div class="code-ln-n" data-line-number="15"></div></td>
        <td class="code-ln-code" data-line-number="15"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">reply_content </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.do_execute(</span><span style="color:#D73A49;--shiki-dark:#F97583">**</span><span style="color:#24292E;--shiki-dark:#E1E4E8">do_execute_args)</span></span></td>
      </tr></tbody></table>21:["$","pre",null,{"className":"language-python pre-code-block shiki github-light github-dark","children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$29"}}]}]
2a:T15f0,<table class="code-ln-table"><tbody><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="1"><div class="code-ln-n" data-line-number="1"></div></td>
        <td class="code-ln-code" data-line-number="1"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">if</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> hasattr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(shell, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"run_cell_async"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">) </span><span style="color:#D73A49;--shiki-dark:#F97583">and</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> hasattr</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(shell, </span><span style="color:#032F62;--shiki-dark:#9ECBFF">"should_run_async"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">):</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="2"><div class="code-ln-n" data-line-number="2"></div></td>
        <td class="code-ln-code" data-line-number="2"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    run_cell </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shell.run_cell_async</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="3"><div class="code-ln-n" data-line-number="3"></div></td>
        <td class="code-ln-code" data-line-number="3"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    should_run_async </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shell.should_run_async</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="4"><div class="code-ln-n" data-line-number="4"></div></td>
        <td class="code-ln-code" data-line-number="4"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    with_cell_id </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> _accepts_parameters(run_cell, [</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"cell_id"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">])</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="5"><div class="code-ln-n" data-line-number="5"></div></td>
        <td class="code-ln-code" data-line-number="5"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">else</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="6"><div class="code-ln-n" data-line-number="6"></div></td>
        <td class="code-ln-code" data-line-number="6"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    should_run_async </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> lambda</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> cell: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">False</span><span style="color:#6A737D;--shiki-dark:#6A737D">  # noqa: ARG005, E731</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="7"><div class="code-ln-n" data-line-number="7"></div></td>
        <td class="code-ln-code" data-line-number="7"><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    # older IPython,</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="8"><div class="code-ln-n" data-line-number="8"></div></td>
        <td class="code-ln-code" data-line-number="8"><span class="line"><span style="color:#6A737D;--shiki-dark:#6A737D">    # use blocking run_cell and wrap it in coroutine</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="9"><div class="code-ln-n" data-line-number="9"></div></td>
        <td class="code-ln-code" data-line-number="9"><span class="line"></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="10"><div class="code-ln-n" data-line-number="10"></div></td>
        <td class="code-ln-code" data-line-number="10"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">    async</span><span style="color:#D73A49;--shiki-dark:#F97583"> def</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> run_cell</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">args, </span><span style="color:#D73A49;--shiki-dark:#F97583">**</span><span style="color:#24292E;--shiki-dark:#E1E4E8">kwargs):</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="11"><div class="code-ln-n" data-line-number="11"></div></td>
        <td class="code-ln-code" data-line-number="11"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        return</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> shell.run_cell(</span><span style="color:#D73A49;--shiki-dark:#F97583">*</span><span style="color:#24292E;--shiki-dark:#E1E4E8">args, </span><span style="color:#D73A49;--shiki-dark:#F97583">**</span><span style="color:#24292E;--shiki-dark:#E1E4E8">kwargs)</span></span></td>
      </tr></tbody></table>22:["$","pre",null,{"className":"language-python pre-code-block shiki github-light github-dark","children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$2a"}}]}]
2b:T27d9,<table class="code-ln-table"><tbody><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="1"><div class="code-ln-n" data-line-number="1"></div></td>
        <td class="code-ln-code" data-line-number="1"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">async</span><span style="color:#D73A49;--shiki-dark:#F97583"> def</span><span style="color:#6F42C1;--shiki-dark:#B392F0"> run_cell_async</span><span style="color:#24292E;--shiki-dark:#E1E4E8">(</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="2"><div class="code-ln-n" data-line-number="2"></div></td>
        <td class="code-ln-code" data-line-number="2"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        self,</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="3"><div class="code-ln-n" data-line-number="3"></div></td>
        <td class="code-ln-code" data-line-number="3"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        raw_cell: </span><span style="color:#005CC5;--shiki-dark:#79B8FF">str</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="4"><div class="code-ln-n" data-line-number="4"></div></td>
        <td class="code-ln-code" data-line-number="4"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        store_history</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">False</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="5"><div class="code-ln-n" data-line-number="5"></div></td>
        <td class="code-ln-code" data-line-number="5"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        silent</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">False</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="6"><div class="code-ln-n" data-line-number="6"></div></td>
        <td class="code-ln-code" data-line-number="6"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        shell_futures</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">True</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="7"><div class="code-ln-n" data-line-number="7"></div></td>
        <td class="code-ln-code" data-line-number="7"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">        *</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="8"><div class="code-ln-n" data-line-number="8"></div></td>
        <td class="code-ln-code" data-line-number="8"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        transformed_cell: Optional[</span><span style="color:#005CC5;--shiki-dark:#79B8FF">str</span><span style="color:#24292E;--shiki-dark:#E1E4E8">] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> None</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="9"><div class="code-ln-n" data-line-number="9"></div></td>
        <td class="code-ln-code" data-line-number="9"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        preprocessing_exc_tuple: Optional[AnyType] </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> None</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="10"><div class="code-ln-n" data-line-number="10"></div></td>
        <td class="code-ln-code" data-line-number="10"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">        cell_id</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF">None</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="11"><div class="code-ln-n" data-line-number="11"></div></td>
        <td class="code-ln-code" data-line-number="11"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">    ) -> ExecutionResult:</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="12"><div class="code-ln-n" data-line-number="12"></div></td>
        <td class="code-ln-code" data-line-number="12"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">//</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ...</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="13"><div class="code-ln-n" data-line-number="13"></div></td>
        <td class="code-ln-code" data-line-number="13"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">code_ast </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> compiler.ast_parse(cell, </span><span style="color:#E36209;--shiki-dark:#FFAB70">filename</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">cell_name)</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="14"><div class="code-ln-n" data-line-number="14"></div></td>
        <td class="code-ln-code" data-line-number="14"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">//</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ...</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="15"><div class="code-ln-n" data-line-number="15"></div></td>
        <td class="code-ln-code" data-line-number="15"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">code_ast </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.transform_ast(code_ast)</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="16"><div class="code-ln-n" data-line-number="16"></div></td>
        <td class="code-ln-code" data-line-number="16"><span class="line"><span style="color:#D73A49;--shiki-dark:#F97583">//</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> ...</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="17"><div class="code-ln-n" data-line-number="17"></div></td>
        <td class="code-ln-code" data-line-number="17"><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">has_raised </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> await</span><span style="color:#005CC5;--shiki-dark:#79B8FF"> self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.run_ast_nodes(code_ast.body, cell_name, </span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="18"><div class="code-ln-n" data-line-number="18"></div></td>
        <td class="code-ln-code" data-line-number="18"><span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">                       interactivity</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">interactivity, </span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="19"><div class="code-ln-n" data-line-number="19"></div></td>
        <td class="code-ln-code" data-line-number="19"><span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">                       compiler</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">compiler, </span><span style="color:#E36209;--shiki-dark:#FFAB70">result</span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8">result)</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="20"><div class="code-ln-n" data-line-number="20"></div></td>
        <td class="code-ln-code" data-line-number="20"><span class="line"></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="21"><div class="code-ln-n" data-line-number="21"></div></td>
        <td class="code-ln-code" data-line-number="21"><span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.last_execution_succeeded </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#D73A49;--shiki-dark:#F97583"> not</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> has_raised</span></span></td>
      </tr><tr class="code-ln-line">
        <td class="code-ln-numbers" data-line-number="22"><div class="code-ln-n" data-line-number="22"></div></td>
        <td class="code-ln-code" data-line-number="22"><span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">self</span><span style="color:#24292E;--shiki-dark:#E1E4E8">.last_execution_result </span><span style="color:#D73A49;--shiki-dark:#F97583">=</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> result</span></span></td>
      </tr></tbody></table>23:["$","pre",null,{"className":"language-python pre-code-block shiki github-light github-dark","children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$2b"}}]}]
