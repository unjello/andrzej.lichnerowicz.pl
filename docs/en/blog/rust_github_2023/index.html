<!DOCTYPE html><html lang="en"><head><title>Rocking Rust, Git, and GitHub in 2023 Like a Pro | Blog @unjello</title><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="next-head-count" content="3"/><link data-react-helmet="true" rel="icon" href="/favicon.ico"/><link rel="preload" href="/_next/static/css/dcdee7caae0a2e50.css" as="style"/><link rel="stylesheet" href="/_next/static/css/dcdee7caae0a2e50.css" data-n-g=""/><link rel="preload" href="/_next/static/css/cb51878233856e9b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cb51878233856e9b.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-fd9fb29a92855ab4.js" defer=""></script><script src="/_next/static/chunks/framework-c87cbe29bcbbc912.js" defer=""></script><script src="/_next/static/chunks/main-ebe6adde5cb10b37.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e0eb60e4766af60d.js" defer=""></script><script src="/_next/static/chunks/bbe12816-19f4f90de11efffb.js" defer=""></script><script src="/_next/static/chunks/956-dbf96916784f3117.js" defer=""></script><script src="/_next/static/chunks/352-abb7b87883533577.js" defer=""></script><script src="/_next/static/chunks/pages/%5Blocale%5D/blog/%5Bid%5D-a3b20aa0099f87e4.js" defer=""></script><script src="/_next/static/2FLjr8nWbisC5bL06pV3C/_buildManifest.js" defer=""></script><script src="/_next/static/2FLjr8nWbisC5bL06pV3C/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><div class="Layout_container__HxK9n container-fluid"><header><div class="LanguageSwitcher_container__n_8ky"></div><section class="Header_container__7xLax"><h1><a href="/">Andrzej unjello Lichnerowicz</a></h1></section><ul class="list-inline Tagline_container__9rkLj"><li class="list-inline-item">he</li><li class="list-inline-item">him</li><li class="list-inline-item">activist</li><li class="list-inline-item">trees and greenery lover</li></ul><ul class="list-inline SocialMediaList_container__THnHQ"><li class="list-inline-item"><a href="https://mastodon.gamedev.place/@unjello">mastodon</a></li><li class="list-inline-item"><a href="https://github.com/unjello">github</a></li><li class="list-inline-item"><a href="mailto:andrzej@lichnerowicz.pl">email</a></li></ul></header><section class="Post_container__qv178"><h1>Rocking Rust, Git, and GitHub in 2023 Like a Pro</h1><div class="Post_date__MxHpb">2023-02-11T10:58:00.000Z</div><div><div class="paragraph">
<div class="title">Falling in Love with SourceHut, But Still Tempted by GitHub Actions</div>
<p><a href="https://git.sr.ht/">SourceHut</a> has recently won my heart with its simplicity and 90&#8217;s UI vibe, but I can&#8217;t resist the appeal of GitHub&#8217;s free workflow automation platform. I&#8217;ve been working on a few small projects in Python, TypeScript, and Rust, and have set up CI for all of them. Now that I&#8217;ve revived my blog, I thought I&#8217;d write about my experience using GitHub Actions for deployment.</p>
</div>
<div class="paragraph">
<p>I use GitHub Actions to deploy my Static Site Generated site to GitHub Pages or upload packages to various registries (pypi, npm, crates). I then added the Continuous Development part with testing, linting, and so on. In my day job, I always advocate for activities like this to be as close to the developer as possible - ideally as a commit pre-hook. I&#8217;ve followed this principle in my own projects, but to make sure I was getting the most out of GitHub Actions, I also added testing on all platforms I wanted to support but didn&#8217;t have easy access to. Lastly, I decided to hit the "fund" button - who knows, maybe it&#8217;ll be my ticket to an early retirement! :)</p>
</div>
<div class="paragraph">
<div class="title">Setting up a Pre-Commit Hook</div>
<p>The first step to creating a smooth workflow is to set up a pre-commit hook. This helps to ensure that code is well-formatted and free of errors before it&#8217;s pushed to the remote repository. To make this happen, I use <a href="https://pre-commit.com">pre-commit</a>. It&#8217;s an amazing tool that works across different programming languages and makes it easy to run checks locally.</p>
</div>
<div class="paragraph">
<p>Getting started is pretty simple, just follow the installation instructions on the pre-commit website. Then, you&#8217;ll need to define the validation rules for your project. Here&#8217;s an example of the rules I use for Rust projects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">repos:
  -   repo: https://github.com/pre-commit/pre-commit-hooks
      rev: v4.4.0
      hooks:
        -   id: fix-byte-order-marker
        -   id: check-case-conflict
        -   id: check-merge-conflict
        -   id: check-symlinks
        -   id: check-yaml
        -   id: check-toml
        -   id: end-of-file-fixer
        -   id: mixed-line-ending
            args: [--fix=lf]
        -   id: trailing-whitespace
  -   repo: https://github.com/doublify/pre-commit-rust
      rev: master
      hooks:
        -   id: fmt
            args: ["--verbose", "--"]
        -   id: cargo-check
        -   id: clippy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, install the rules with the pre-commit install command. This will set up the .git/hooks/pre-commit file for you. Keep in mind that this file is not synced to the remote repository, so each developer will need to run the setup locally. To make this easier, I like to create a file with useful commands using a tool called <a href="https://github.com/casey/just">just</a>.</p>
</div>
<div class="paragraph">
<p>With the following <code>Justfile</code>, you can run <code>just install</code> to create the hooks and <code>just prehook</code> to run checks on demand:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-makefile hljs" data-lang="makefile">configure:
	pre-commit install

precommit:
	pre-commit run --all-files</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Triggering Your Workflow</div>
<p>The next step in setting up your workflow is to determine when it should run. I usually use just a couple of triggers.</p>
</div>
<div class="paragraph">
<p>For everyday Continuous Integration, I set it up to run on every push or pull request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">on: [push, pull_request]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If I have some expensive tests that take a long time to run, I&#8217;ll schedule them to run nightly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">on:
  schedule:
    - cron: "0 0 * * *"</code></pre>
</div>
</div>
<div class="paragraph">
<p>For libraries or websites - anything that gets published - I have a separate workflow that&#8217;s triggered by gh release create:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">on:
  release:
    types: [created]</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Defining your testing strategy matrix</div>
<p>When it comes to testing on different platforms, I love using GitHub Actions. It&#8217;s super easy to use and just works for me. Sure, some people may have had issues with the stability of GitHub&#8217;s workers, but I haven&#8217;t had any problems yet. I&#8217;m not doing any heavy compiling, so I might just be lucky.</p>
</div>
<div class="paragraph">
<p>To test on different platforms, we&#8217;ll be using something called a <a href="https://docs.github.com/en/actions/using-jobs/using-a-matrix-for-your-jobs">strategy matrix</a>. There are a few ways to define this matrix, like providing separate lists of OS types and hardware architectures and letting GitHub calculate all the possibilities. But, I usually just keep it simple and go for a list of 64-bit Windows, 64-bit Linux, and both Intel and ARM macOS.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jobs:
  dist:
    strategy:
      matrix:
        include:
          - os: windows-latest
            target: x86_64-pc-windows-msvc
            code-target: win32-x64
          - os: windows-latest
            target: aarch64-pc-windows-msvc
            code-target: win32-arm64
          - os: ubuntu-20.04
            target: x86_64-unknown-linux-gnu
            code-target: linux-x64
            container: ubuntu:18.04
          - os: macos-11
            target: x86_64-apple-darwin
            code-target: darwin-x64
          - os: macos-11
            target: aarch64-apple-darwin
            code-target: darwin-arm64</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Running validation</div>
<p>If you&#8217;ve been following along, now it&#8217;s time to actually run the validation checks on our code. But first, for our Ubuntu workflow, you&#8217;ll need to install some build tools first:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">if: contains(matrix.os, 'ubuntu')
run: apt-get update &amp;&amp; apt-get install -y curl build-essential gcc g++</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, for the actual validation, we&#8217;ll be using GitHub Actions. Actions are packages in JavaScript or TypeScript format, and we&#8217;ll be using the official <a href="https://github.com/actions/checkout">actions/checkout</a> to checkout our code. This action is provided by GitHub and is the recommended way to do this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">uses: actions/checkout@v3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, we&#8217;ll use the <a href="https://github.com/actions-rs">action-rs</a> package to handle everything we need for our continuous integration pipeline: installing the toolchain, running formatting checks, clippy checks, and tests. This is how my <code>.github/workflows/ci.yaml</code> looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">on: [push, pull_request]

name: CI

jobs:
  dist:
    strategy:
      matrix:
        include:
          - os: windows-latest
            target: x86_64-pc-windows-msvc
            code-target: win32-x64
          - os: windows-latest
            target: aarch64-pc-windows-msvc
            code-target: win32-arm64
          - os: ubuntu-20.04
            target: x86_64-unknown-linux-gnu
            code-target: linux-x64
            container: ubuntu:18.04
          - os: macos-11
            target: x86_64-apple-darwin
            code-target: darwin-x64
          - os: macos-11
            target: aarch64-apple-darwin
            code-target: darwin-arm64

    name: dist (${{ matrix.target }})
    runs-on: ${{ matrix.os }}
    container: ${{ matrix.container }}

    steps:
      - name: Install prerequisites
        if: contains(matrix.os, 'ubuntu')
        run: apt-get update &amp;&amp; apt-get install -y curl build-essential gcc g++

      - name: Checkout sources
        uses: actions/checkout@v3

      - name: Install Rust toolchain
        uses: actions-rs/toolchain@v1
        with:
          profile: minimal
          toolchain: stable
          override: true
          target: ${{ matrix.target }}
          components: rustfmt, clippy, rust-src

      - name: Run cargo check
        uses: actions-rs/cargo@v1
        with:
          command: check

      - name: Run cargo test
        uses: actions-rs/cargo@v1
        with:
          command: test

      - name: Run cargo fmt
        uses: actions-rs/cargo@v1
        with:
          command: fmt
          args: --all -- --check

      - name: Run cargo clippy
        uses: actions-rs/cargo@v1
        with:
          command: clippy
          args: -- -D warnings</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Publishing to Crates.io</div>
<p>To have a complete publishing pipeline, we need to create an API token. You can do this by going to the <a href="https://crates.io/settings/tokens">API Tokens</a> page on <a href="https://crates.io/">crates.io</a> and creating a new token. After that, go to your repository&#8217;s <code>Settings &gt; Secrets and variables &gt; Actions</code> and create a new repository secret, so that the token is visible to the actions without being exposed publicly. I typically name it <code>CRATES_TOKEN</code>.</p>
</div>
<div class="paragraph">
<p>There are a few ways to publish packages, but I prefer to create both a <strong>tag</strong> and a <strong>release</strong>. First, I create a separate pipeline that is triggered by creating a release.</p>
</div>
<div class="paragraph">
<p>The YAML code looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">name: Publish Package to crates.io
on:
  release:
    types: [created]
jobs:
  publish:
    name: Publish
    runs-on: ubuntu-latest
    steps:
      - name: Checkout sources
        uses: actions/checkout@v3

      - name: Install stable toolchain
        uses: actions-rs/toolchain@v1
        with:
          profile: minimal
          toolchain: stable
          override: true

      - run: cargo publish --token ${CRATES_TOKEN}
        env:
          CRATES_TOKEN: ${{ secrets.CRATES_TOKEN }}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are multiple ways to create a release, including using GitHub&#8217;s REST API, but I prefer to use the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">$ git tag -a v0.1.0 -m "Tagging v0.1.0"
$ gh release create v0.1.0 -t "Release v0.1.0"</code></pre>
</div>
</div></div><section class="Comments_container__LnG2x"><h2>Comments</h2><div role="status" animation="border" class="spinner-border-sm spinner-border text-secondary"><span class="visually-hidden">Loading...</span></div></section></section><footer class="fs-6 text-muted mt-5 Footer_container__j1zF1"><p>CC0. <!-- -->Powered by<!-- --> <a href="https://nextjs.org/">next.js</a>. <!-- -->Theme inspired by<!-- --> <a href="https://www.mattdesl.com/">@mattdesl</a> <!-- -->and<!-- --> <a href="https://ozafoto.com/digital/">Oza</a>.</p></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"_nextI18Next":{"initialI18nStore":{"en":{"common":{"back-to-home":"Back to home","error-with-status":"A {{statusCode}} error occurred on server","error-without-status":"An error occurred on the server","h1":"A simple example","to-second-page":"To second page"},"blog":{"title":"Blog @unjello"},"comments":{"header":"Comments","discussion_is_at":"The actual discussion is happening on ","welcome":"Come over, don't be shy!","error":"Something went wrong with fetching the comments."},"header":{"he":"he","him":"him","activist":"activist","trees_lover":"trees and greenery lover"},"footer":{"powered_by":"Powered by","inspired_by":"Theme inspired by","and":"and"}}},"initialLocale":"en","ns":["common","blog","comments","header","footer"],"userConfig":{"debug":false,"i18n":{"defaultLocale":"en","locales":["en"]},"reloadOnPrerender":false,"default":{"debug":false,"i18n":{"defaultLocale":"en","locales":["en"]},"reloadOnPrerender":false}}},"posts":{"index":{"id":"index","content":"\u003cp\u003eRandom things the voices in my head told me to write down.\u003c/p\u003e","title":"Blog","date":"","card":"","url":"","type":"","where":"","rank":"","mastodonId":""},"items":[{"id":"rust_github_2023","content":"\u003cdiv class=\"paragraph\"\u003e\n\u003cdiv class=\"title\"\u003eFalling in Love with SourceHut, But Still Tempted by GitHub Actions\u003c/div\u003e\n\u003cp\u003e\u003ca href=\"https://git.sr.ht/\"\u003eSourceHut\u003c/a\u003e has recently won my heart with its simplicity and 90\u0026#8217;s UI vibe, but I can\u0026#8217;t resist the appeal of GitHub\u0026#8217;s free workflow automation platform. I\u0026#8217;ve been working on a few small projects in Python, TypeScript, and Rust, and have set up CI for all of them. Now that I\u0026#8217;ve revived my blog, I thought I\u0026#8217;d write about my experience using GitHub Actions for deployment.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eI use GitHub Actions to deploy my Static Site Generated site to GitHub Pages or upload packages to various registries (pypi, npm, crates). I then added the Continuous Development part with testing, linting, and so on. In my day job, I always advocate for activities like this to be as close to the developer as possible - ideally as a commit pre-hook. I\u0026#8217;ve followed this principle in my own projects, but to make sure I was getting the most out of GitHub Actions, I also added testing on all platforms I wanted to support but didn\u0026#8217;t have easy access to. Lastly, I decided to hit the \"fund\" button - who knows, maybe it\u0026#8217;ll be my ticket to an early retirement! :)\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cdiv class=\"title\"\u003eSetting up a Pre-Commit Hook\u003c/div\u003e\n\u003cp\u003eThe first step to creating a smooth workflow is to set up a pre-commit hook. This helps to ensure that code is well-formatted and free of errors before it\u0026#8217;s pushed to the remote repository. To make this happen, I use \u003ca href=\"https://pre-commit.com\"\u003epre-commit\u003c/a\u003e. It\u0026#8217;s an amazing tool that works across different programming languages and makes it easy to run checks locally.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eGetting started is pretty simple, just follow the installation instructions on the pre-commit website. Then, you\u0026#8217;ll need to define the validation rules for your project. Here\u0026#8217;s an example of the rules I use for Rust projects:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-yaml hljs\" data-lang=\"yaml\"\u003erepos:\n  -   repo: https://github.com/pre-commit/pre-commit-hooks\n      rev: v4.4.0\n      hooks:\n        -   id: fix-byte-order-marker\n        -   id: check-case-conflict\n        -   id: check-merge-conflict\n        -   id: check-symlinks\n        -   id: check-yaml\n        -   id: check-toml\n        -   id: end-of-file-fixer\n        -   id: mixed-line-ending\n            args: [--fix=lf]\n        -   id: trailing-whitespace\n  -   repo: https://github.com/doublify/pre-commit-rust\n      rev: master\n      hooks:\n        -   id: fmt\n            args: [\"--verbose\", \"--\"]\n        -   id: cargo-check\n        -   id: clippy\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eNext, install the rules with the pre-commit install command. This will set up the .git/hooks/pre-commit file for you. Keep in mind that this file is not synced to the remote repository, so each developer will need to run the setup locally. To make this easier, I like to create a file with useful commands using a tool called \u003ca href=\"https://github.com/casey/just\"\u003ejust\u003c/a\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eWith the following \u003ccode\u003eJustfile\u003c/code\u003e, you can run \u003ccode\u003ejust install\u003c/code\u003e to create the hooks and \u003ccode\u003ejust prehook\u003c/code\u003e to run checks on demand:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-makefile hljs\" data-lang=\"makefile\"\u003econfigure:\n\tpre-commit install\n\nprecommit:\n\tpre-commit run --all-files\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cdiv class=\"title\"\u003eTriggering Your Workflow\u003c/div\u003e\n\u003cp\u003eThe next step in setting up your workflow is to determine when it should run. I usually use just a couple of triggers.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFor everyday Continuous Integration, I set it up to run on every push or pull request:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-yaml hljs\" data-lang=\"yaml\"\u003eon: [push, pull_request]\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eIf I have some expensive tests that take a long time to run, I\u0026#8217;ll schedule them to run nightly:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-yaml hljs\" data-lang=\"yaml\"\u003eon:\n  schedule:\n    - cron: \"0 0 * * *\"\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eFor libraries or websites - anything that gets published - I have a separate workflow that\u0026#8217;s triggered by gh release create:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-yaml hljs\" data-lang=\"yaml\"\u003eon:\n  release:\n    types: [created]\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cdiv class=\"title\"\u003eDefining your testing strategy matrix\u003c/div\u003e\n\u003cp\u003eWhen it comes to testing on different platforms, I love using GitHub Actions. It\u0026#8217;s super easy to use and just works for me. Sure, some people may have had issues with the stability of GitHub\u0026#8217;s workers, but I haven\u0026#8217;t had any problems yet. I\u0026#8217;m not doing any heavy compiling, so I might just be lucky.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eTo test on different platforms, we\u0026#8217;ll be using something called a \u003ca href=\"https://docs.github.com/en/actions/using-jobs/using-a-matrix-for-your-jobs\"\u003estrategy matrix\u003c/a\u003e. There are a few ways to define this matrix, like providing separate lists of OS types and hardware architectures and letting GitHub calculate all the possibilities. But, I usually just keep it simple and go for a list of 64-bit Windows, 64-bit Linux, and both Intel and ARM macOS.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-yaml hljs\" data-lang=\"yaml\"\u003ejobs:\n  dist:\n    strategy:\n      matrix:\n        include:\n          - os: windows-latest\n            target: x86_64-pc-windows-msvc\n            code-target: win32-x64\n          - os: windows-latest\n            target: aarch64-pc-windows-msvc\n            code-target: win32-arm64\n          - os: ubuntu-20.04\n            target: x86_64-unknown-linux-gnu\n            code-target: linux-x64\n            container: ubuntu:18.04\n          - os: macos-11\n            target: x86_64-apple-darwin\n            code-target: darwin-x64\n          - os: macos-11\n            target: aarch64-apple-darwin\n            code-target: darwin-arm64\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cdiv class=\"title\"\u003eRunning validation\u003c/div\u003e\n\u003cp\u003eIf you\u0026#8217;ve been following along, now it\u0026#8217;s time to actually run the validation checks on our code. But first, for our Ubuntu workflow, you\u0026#8217;ll need to install some build tools first:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-yaml hljs\" data-lang=\"yaml\"\u003eif: contains(matrix.os, 'ubuntu')\nrun: apt-get update \u0026amp;\u0026amp; apt-get install -y curl build-essential gcc g++\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eNow, for the actual validation, we\u0026#8217;ll be using GitHub Actions. Actions are packages in JavaScript or TypeScript format, and we\u0026#8217;ll be using the official \u003ca href=\"https://github.com/actions/checkout\"\u003eactions/checkout\u003c/a\u003e to checkout our code. This action is provided by GitHub and is the recommended way to do this.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-yaml hljs\" data-lang=\"yaml\"\u003euses: actions/checkout@v3\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eNext, we\u0026#8217;ll use the \u003ca href=\"https://github.com/actions-rs\"\u003eaction-rs\u003c/a\u003e package to handle everything we need for our continuous integration pipeline: installing the toolchain, running formatting checks, clippy checks, and tests. This is how my \u003ccode\u003e.github/workflows/ci.yaml\u003c/code\u003e looks like:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-yaml hljs\" data-lang=\"yaml\"\u003eon: [push, pull_request]\n\nname: CI\n\njobs:\n  dist:\n    strategy:\n      matrix:\n        include:\n          - os: windows-latest\n            target: x86_64-pc-windows-msvc\n            code-target: win32-x64\n          - os: windows-latest\n            target: aarch64-pc-windows-msvc\n            code-target: win32-arm64\n          - os: ubuntu-20.04\n            target: x86_64-unknown-linux-gnu\n            code-target: linux-x64\n            container: ubuntu:18.04\n          - os: macos-11\n            target: x86_64-apple-darwin\n            code-target: darwin-x64\n          - os: macos-11\n            target: aarch64-apple-darwin\n            code-target: darwin-arm64\n\n    name: dist (${{ matrix.target }})\n    runs-on: ${{ matrix.os }}\n    container: ${{ matrix.container }}\n\n    steps:\n      - name: Install prerequisites\n        if: contains(matrix.os, 'ubuntu')\n        run: apt-get update \u0026amp;\u0026amp; apt-get install -y curl build-essential gcc g++\n\n      - name: Checkout sources\n        uses: actions/checkout@v3\n\n      - name: Install Rust toolchain\n        uses: actions-rs/toolchain@v1\n        with:\n          profile: minimal\n          toolchain: stable\n          override: true\n          target: ${{ matrix.target }}\n          components: rustfmt, clippy, rust-src\n\n      - name: Run cargo check\n        uses: actions-rs/cargo@v1\n        with:\n          command: check\n\n      - name: Run cargo test\n        uses: actions-rs/cargo@v1\n        with:\n          command: test\n\n      - name: Run cargo fmt\n        uses: actions-rs/cargo@v1\n        with:\n          command: fmt\n          args: --all -- --check\n\n      - name: Run cargo clippy\n        uses: actions-rs/cargo@v1\n        with:\n          command: clippy\n          args: -- -D warnings\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cdiv class=\"title\"\u003ePublishing to Crates.io\u003c/div\u003e\n\u003cp\u003eTo have a complete publishing pipeline, we need to create an API token. You can do this by going to the \u003ca href=\"https://crates.io/settings/tokens\"\u003eAPI Tokens\u003c/a\u003e page on \u003ca href=\"https://crates.io/\"\u003ecrates.io\u003c/a\u003e and creating a new token. After that, go to your repository\u0026#8217;s \u003ccode\u003eSettings \u0026gt; Secrets and variables \u0026gt; Actions\u003c/code\u003e and create a new repository secret, so that the token is visible to the actions without being exposed publicly. I typically name it \u003ccode\u003eCRATES_TOKEN\u003c/code\u003e.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThere are a few ways to publish packages, but I prefer to create both a \u003cstrong\u003etag\u003c/strong\u003e and a \u003cstrong\u003erelease\u003c/strong\u003e. First, I create a separate pipeline that is triggered by creating a release.\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThe YAML code looks like this:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-yaml hljs\" data-lang=\"yaml\"\u003ename: Publish Package to crates.io\non:\n  release:\n    types: [created]\njobs:\n  publish:\n    name: Publish\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout sources\n        uses: actions/checkout@v3\n\n      - name: Install stable toolchain\n        uses: actions-rs/toolchain@v1\n        with:\n          profile: minimal\n          toolchain: stable\n          override: true\n\n      - run: cargo publish --token ${CRATES_TOKEN}\n        env:\n          CRATES_TOKEN: ${{ secrets.CRATES_TOKEN }}\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv class=\"paragraph\"\u003e\n\u003cp\u003eThere are multiple ways to create a release, including using GitHub\u0026#8217;s REST API, but I prefer to use the command line:\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv class=\"listingblock\"\u003e\n\u003cdiv class=\"content\"\u003e\n\u003cpre class=\"highlightjs highlight\"\u003e\u003ccode class=\"language-sh hljs\" data-lang=\"sh\"\u003e$ git tag -a v0.1.0 -m \"Tagging v0.1.0\"\n$ gh release create v0.1.0 -t \"Release v0.1.0\"\u003c/code\u003e\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"Rocking Rust, Git, and GitHub in 2023 Like a Pro","date":"2023-02-11T10:58:00.000Z","card":"","url":"","type":"","where":"","rank":"","mastodonId":"120321"},{"id":"same_old_story","content":"\u003cp\u003e\u003cimg src=\"/casablanca.jpg\" alt=\"Dooley Wilson, Ingrid Bergman and Humphrey Bogart in a frame from Hollywood\u0026#x27;s classic: Cassablanca\"\u003e\u003c/p\u003e\n\u003cp\u003eI don't think I even remember anymore, how many times I have restarted the blog. Last time I wrote something useful, was probably around 2008.\u003c/p\u003e\n\u003cp\u003eI still have the old sites backed up somewhere. At least few of them. Unfortunately they're not very useful, mostly because they have been using blogging engines -- either Wordpress-like, or my own -- and while I backed up the code, I did not export anything from the database, leaving myself with just the looks, and no content.\u003c/p\u003e\n\u003cp\u003eIn 2017 I have discovered \u003ca href=\"https://gohugo.io/\"\u003eStatic Site Generators\u003c/a\u003e, and it changed my approach completely. Primarily, because engines, blogging engines, and Wordpress above anything else, are just one big \u003ca href=\"https://en.wikipedia.org/wiki/Honeypot_(computing)\"\u003ehoneypots\u003c/a\u003e. The fact that I didn't have to spin up any MySQL instance and therefore hosting costs dropped to big fat zero, after introduction of \u003ca href=\"https://pages.github.com\"\u003eGitHub Pages\u003c/a\u003e was a big plus, but the biggest benefit of them all is the fact, that I have a full, working and accessible copy of my blog. If only I continued to write :)\u003c/p\u003e\n\u003cp\u003eI hope, this time will truly be better :)\u003c/p\u003e","title":"It's still the same old story","date":"2023-02-07T15:28:00.000Z","card":"","url":"","type":"","where":"","rank":"","mastodonId":"109825295757896454"},{"id":"reboot","content":"\u003cpre\u003e\u003ccode class=\"hljs language-shell\"\u003e\u003cspan class=\"hljs-meta prompt_\"\u003e% \u003c/span\u003e\u003cspan class=\"bash\"\u003e/sbin/shutdown -r now\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIt begins to strike me, that I may not be good at blogging. Let's see if I can make it this time.\u003c/p\u003e","title":"One more time?","date":"2021-06-26T08:35:00.000Z","card":"","url":"","type":"","where":"","rank":"","mastodonId":""},{"id":"initial-revision","content":"\u003cpre\u003e\u003ccode class=\"hljs language-shell\"\u003e\u003cspan class=\"hljs-meta prompt_\"\u003e% \u003c/span\u003e\u003cspan class=\"bash\"\u003eletter\u003c/span\u003e\r\nletter: Command not found.\r\u003cspan class=\"hljs-meta prompt_\"\u003e\n% \u003c/span\u003e\u003cspan class=\"bash\"\u003email\u003c/span\u003e\r\nTo: ^X ^F ^C\r\u003cspan class=\"hljs-meta prompt_\"\u003e\n% \u003c/span\u003e\u003cspan class=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003ehelp\u003c/span\u003e mail\u003c/span\u003e\r\nhelp: Command not found.\r\u003cspan class=\"hljs-meta prompt_\"\u003e\n% \u003c/span\u003e\u003cspan class=\"bash\"\u003edamn!\u003c/span\u003e\r\n!: Event unrecognized\r\u003cspan class=\"hljs-meta prompt_\"\u003e\n% \u003c/span\u003e\u003cspan class=\"bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003elogout\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIt's been sort of a tradition, to begin each incarnation of my blog, with a quote from this old joke\u003csup\u003e\u003ca href=\"#user-content-fn-1\" id=\"user-content-fnref-1\" data-footnote-ref aria-describedby=\"footnote-label\"\u003e1\u003c/a\u003e\u003c/sup\u003e. If one can trust \u003cem\u003ethe, uh, Internets\u003c/em\u003e, this blog was esentially down since 2007. A decade! Enough is enough. Time to get back.\u003c/p\u003e\n\u003csection data-footnotes class=\"footnotes\"\u003e\u003ch2 class=\"sr-only\" id=\"footnote-label\"\u003eFootnotes\u003c/h2\u003e\n\u003col\u003e\n\u003cli id=\"user-content-fn-1\"\u003e\n\u003cp\u003e\u003ca href=\"https://gist.github.com/D3MZ/3915286\"\u003ehttps://gist.github.com/D3MZ/3915286\u003c/a\u003e \u003ca href=\"#user-content-fnref-1\" data-footnote-backref class=\"data-footnote-backref\" aria-label=\"Back to content\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/section\u003e","title":"Initial Revision","date":"2017-11-05T09:44:44.000Z","card":"","url":"","type":"","where":"","rank":"","mastodonId":""}]}},"__N_SSG":true},"page":"/[locale]/blog/[id]","query":{"locale":"en","id":"rust_github_2023"},"buildId":"2FLjr8nWbisC5bL06pV3C","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>